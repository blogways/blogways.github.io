I"ñQ<table>
  <thead>
    <tr>
      <th>Â </th>
      <th><em>ç›® å½•</em></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td><a href="#cpu">è·å–CPUæ•°æ®</a></td>
    </tr>
    <tr>
      <td>2</td>
      <td><a href="#mem">è·å–å†…å­˜/SWAPæ•°æ®</a></td>
    </tr>
    <tr>
      <td>3</td>
      <td><a href="#disk">è·å–ç£ç›˜æ•°æ®</a></td>
    </tr>
    <tr>
      <td>4</td>
      <td><a href="#dir">è·å–ç›®å½•æ•°æ®</a></td>
    </tr>
  </tbody>
</table>

<h2 id="ä¸€è·å–cpuæ•°æ®-">ä¸€ã€è·å–CPUæ•°æ® <a name="cpu"></a></h2>

<p>mpstatæ˜¯MultiProcessor Statisticsçš„ç¼©å†™ï¼Œç”¨äºæ”¶é›†å’Œæ˜¾ç¤ºç³»ç»Ÿä¸­çš„æ‰€æœ‰å¤„ç†å™¨çš„æ€§èƒ½ç»Ÿè®¡ï¼Œå¹¶ä¸”å¾—åˆ°è¯¦ç»†çš„å•ä¸ªå¤„ç†å™¨çš„è¿è¡ŒçŠ¶å†µã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   $mpstat
   
   System configuration: lcpu=16 mode=Capped 
   
   cpu  min  maj  mpc  int   cs  ics   rq  mig lpa sysc us sy wa id   pc
     0 184046638 214424  274 3908673210 3782119157 1326252330    0 26139925 100 6707390946  1  1  0 98 0.14
     1 7171412 14613  254 193245713 154941530 78622875    0 1126081 100 693934930  0  0  0 100 0.14
     2 170845575 230472  101 1308931839 2167522165 818427086    0 26083149 100 4900640467  1  1  0 99 0.14
     3 3193293 7611  101 236575152 198239437 153835438    0 1207732 100 139876648  0  0  0 100 0.14
     4 159868990 227718  129 1130251601 1850725273 692517872    0 12009046 100 2854042300  1  1  0 99 0.14
     5 5647834 30697  101 195761607 162561260 82402841    0 1132055 100 362309277  0  0  0 100 0.14
     6 157000962 211598  128 1099788787 1740814939 640685578    0 11993602 100 2992005605  1  1  0 99 0.14
     ......
   ALL 1370435922 2192633 3012 14099748600 18474769270 6889638308    1 139959495 100 36629470849  0  0  0 99 2.29
   
   #è¯¥å‘½ä»¤æ£€æµ‹ç³»ç»Ÿä¸­å…¨éƒ¨å¤„ç†å™¨çš„åˆ©ç”¨æƒ…å†µï¼Œå¹¶ä¸”ç»™å‡ºå„é¡¹çš„æ€»å’Œã€‚ä¸‹é¢æ˜¯å‡ ä¸ªå¸¸ç”¨çš„è¾“å‡ºé¡¹
   #lcpu: å·¥ä½œçš„é€»è¾‘å¤„ç†å™¨çš„ä¸ªæ•° 
   #us: è¿è¡Œçš„ç”¨æˆ·ç¨‹åºæ‰€å ç”¨çš„ CPU ç™¾åˆ†æ¯” 
   #sy: è¿è¡Œçš„å†…æ ¸ç¨‹åºæ‰€å ç”¨çš„ CPU ç™¾åˆ†æ¯” 
   #wa: CPU ç”¨æ¥ç­‰å¾… IO æ‰€å ç”¨çš„ç™¾åˆ†æ¯” 
   #id: CPU ç©ºé—²ä¸”ä¸ç­‰å¾… IO æ‰€å ç”¨çš„ç™¾åˆ†æ¯”
</code></pre></div></div>

<p>ä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå¾€å¾€ä¼šåŠ ä¸Š -a å‚æ•°ï¼Œå³ mpstat -a ï¼Œä»¥å®½è¾“å‡ºæ¨¡å¼æ˜¾ç¤ºæ‰€æœ‰çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä¸‹é¢æ¥æ„Ÿå—ä¸€ä¸‹â€¦â€¦</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $mpstat -a
    
    
System configuration: lcpu=16 mode=Capped 

cpu    min    maj   mpcs   mpcr    dev   soft    dec     ph     cs    ics  bound     rq   push S3pull  S3grd  S0rd  S1rd  S2rd  S3rd  S4rd  S5rd   sysc    us    sy    wa    id    pc   ilcs   vlcs  istol  bstol S3hrd S4hrd S5hrd
  0 184061070 214424    150    124 4310333 590469189 3306344682 8099285 3782890620 1326486636      0      0      0   7911 172073  98.9   0.0   0.0   1.0   0.0   0.0 6707965194   0.7   1.2   0.0  98.1  0.14      0 2681118967    0.0    0.0 100.0   0.0   0.0
  1 7171412  14613    167     87 4313856 1079722 186685547 1177054 154944893 78624637      0      0      0    579     21  98.6   1.4   0.0   0.0   0.0   0.0 693937155   0.0   0.1   0.0  99.9  0.14     17 200960974    0.0    0.0  99.4   0.0   0.6
  2 170859397 230472      3     98 4311630 24093376 1267078359 13630503 2167851281 818525974      1      1      0   3487  23722  98.1   0.0   0.0   1.9   0.0   0.0 4900880379   0.6   0.8   0.0  98.6  0.14     68 1049149272    0.0    0.0 100.0   0.0   0.0
  3 3193904   7611      3     98 4314206 1526924 229574778 1176611 198256684 153848135      0      0      0    266     44  99.2   0.7   0.0   0.1   0.0   0.0 139878645   0.0   0.1   0.0  99.9  0.14     30 275388781    0.0    0.0  99.7   0.0   0.3
  4 159881624 227718     33     96 4312115 20541062 1104121880 1401356 1850937520 692592197      0      0      0   4393  27574  99.0   0.0   0.0   0.9   0.0   0.1 2854195957   0.5   0.6   0.0  98.8  0.14     60 905205613    0.0    0.0  99.9   0.0   0.1
  5 5647840  30697      3     98 4314215 1797627 188492566 1175045 162579018 82411800      0      0      0    129    978  98.6   1.4   0.0   0.0   0.0   0.0 362318106   0.0   0.1   0.0  99.9  0.14     27 203720025    0.0    0.0  99.3   0.0   0.7
  6 157024188 211598     32     96 4313516 22509032 1071873739 1262410 1741141601 640807004      0      0      0   4196  10466  98.9   0.0   0.0   1.1   0.0   0.0 2992221777   0.5   0.8   0.0  98.7  0.14     56 876887437    0.0    0.0  99.9   0.0   0.1
  ......
ALL 1370536873 2192649   1506   1506 69017506 783158186 13210473966 38730670 18477226175 6890502684      1      1      0  38922 271366  98.8   0.1   0.0   1.1   0.0   0.0 36632650675   0.3   0.4   0.0  99.3  2.29    596 10830086125    0.0    0.0  99.9   0.0   0.1
</code></pre></div></div>

<p>è¾“å‡ºçš„ç»“æœå¾ˆè¯¦ç»†ï¼Œä½†ä¹Ÿå¾ˆæ··ä¹±ï¼Œè®©äººçœ¼èŠ±ç¼­ä¹±ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç»“æœæ ¼å¼åŒ–å¤„ç†ï¼Œå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•°æ®.</p>

<h4 id="ä¾‹1è·å–å½“å‰ä¸»æœºæ€»cpuä½¿ç”¨ç‡">ä¾‹1:è·å–å½“å‰ä¸»æœºæ€»CPUä½¿ç”¨ç‡</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $mpstat -a|grep ALL|awk '{printf "å½“å‰ä¸»æœºæ€»CPUä½¿ç”¨ç‡=%s",$24+$25}'
    å½“å‰ä¸»æœºæ€»CPUä½¿ç”¨ç‡=0.7
    
    #é€šè¿‡ grep ALL ä»…è¾“å‡ºæ€»è®¡ä¸€è¡Œçš„æ•°æ®,å†ä½¿ç”¨ awk å‘½ä»¤,å°†ç¬¬24ã€25åŸŸ,ä¹Ÿå°±æ˜¯uså’Œsyä¸¤åˆ—çš„æ•°æ®ç›¸åŠ è·å¾—å®Œæ•´çš„CPUä½¿ç”¨ç‡
    
</code></pre></div></div>

<h4 id="ä¾‹2æ˜¾ç¤ºæ‰€æœ‰å¤„ç†å™¨çš„cpuä½¿ç”¨ç‡">ä¾‹2:æ˜¾ç¤ºæ‰€æœ‰å¤„ç†å™¨çš„CPUä½¿ç”¨ç‡</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $mpstat -a|sed -n '5,$'p|sed '$d'|awk '{print "cpu"$1"ä½¿ç”¨ç‡:",$24+$25}'
    cpu0ä½¿ç”¨ç‡: 1.9
    cpu1ä½¿ç”¨ç‡: 0.1
    cpu2ä½¿ç”¨ç‡: 1.4
    cpu3ä½¿ç”¨ç‡: 0.1
    cpu4ä½¿ç”¨ç‡: 1.1
    cpu5ä½¿ç”¨ç‡: 0.1
    cpu6ä½¿ç”¨ç‡: 1.3
    cpu7ä½¿ç”¨ç‡: 0.1
    cpu8ä½¿ç”¨ç‡: 1.2
    cpu9ä½¿ç”¨ç‡: 0.2
    cpu10ä½¿ç”¨ç‡: 1.3
    cpu11ä½¿ç”¨ç‡: 0.2
    cpu12ä½¿ç”¨ç‡: 1.2
    cpu13ä½¿ç”¨ç‡: 0.1
    cpu14ä½¿ç”¨ç‡: 1.3
    cpu15ä½¿ç”¨ç‡: 0.1
    
    # sed -n '5,$'p å‘½ä»¤è¡¨ç¤ºå–ç¬¬5è¡Œåˆ°æœ€åä¸€è¡Œçš„æ•°æ®
    # sed '$d' å‘½ä»¤è¡¨ç¤ºåˆ é™¤æœ€åä¸€è¡Œ
</code></pre></div></div>

<h2 id="äºŒè·å–å†…å­˜swapæ•°æ®-">äºŒã€è·å–å†…å­˜/SWAPæ•°æ® <a name="mem"></a></h2>

<p>æƒ³è¦è·å–ä¸»æœºå½“å‰å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¯é€šè¿‡svmon -Gæ¥æ˜¾ç¤ºã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $svmon -G
                   size       inuse        free         pin     virtual   mmode
    memory     65667072    12659615    53007457     3591255     7719427     Ded
    pg space    8388608       20086
    
                   work        pers        clnt       other
    pin         1719367           0           0     1871888
    in use      7719427           0     4940188
    
    PageSize   PoolSize       inuse        pgsp         pin     virtual
    s    4 KB         -    10953407       20086     2153575     6013219
    m   64 KB         -      106638           0       89855      106638


    # å…¶ä¸­,å†…å­˜æƒ…å†µå¯æŸ¥çœ‹memoryä¸€è¡Œ
    # pg spaceä¸€è¡Œå³SWAPçš„æƒ…å†µ
    # size -- æ€»å®¹é‡
    # inuse -- å·²ä½¿ç”¨é‡
    # free -- ç©ºé—²é‡
    # å¦å¤–,è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªè¦æ³¨æ„çš„åœ°æ–¹
    # æ¯”å¦‚ä¸Šå›¾ä¸­,pg spaceçš„sizeä¸º8388608,è€Œè¿™é‡Œçš„å•ä½æ˜¯é¡µ,å¹¶ä¸æ˜¯å¹³å¸¸çš„KBã€MBç­‰ï¼Œè¿™æ¶‰åŠåˆ°å†…å­˜æ®µ(segment)çš„çŸ¥è¯†ï¼Œè¿™é‡Œå°±ä¸åŠ ä»¥èµ˜è¿°ï¼Œä»…è¯´æ˜æ¢ç®—æ–¹å¼
    # 1é¡µ=4KB 1MB=256é¡µ
    # æ‰€ä»¥,æ­¤å¤„pg spaceçš„sizeå®é™…ä¸Šæ˜¯ 33554432KB 32768MB
</code></pre></div></div>

<p>çŸ¥é“äº†å‘½ä»¤,ä¸‹é¢æ¥çœ‹çœ‹å…·ä½“çš„ä¾‹å­ã€‚</p>

<h4 id="ä¾‹1è·å–å½“å‰ä¸»æœºå†…å­˜å’Œswapçš„æ€»å®¹é‡å·²ä½¿ç”¨é‡å’Œä½¿ç”¨ç‡">ä¾‹1:è·å–å½“å‰ä¸»æœºå†…å­˜å’ŒSWAPçš„æ€»å®¹é‡ã€å·²ä½¿ç”¨é‡å’Œä½¿ç”¨ç‡</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $svmon -G|grep -E 'memory|pg space'|awk '{if($1=="memory"){print $1,$2/256"M",$3/256"M",$3/$2} else {print $1$2,$3/256"M",$4/256"M",$4/$3}}'
    memory 256512M 49452.9M 0.19279
    pgspace 32768M 78.4609M 0.00239444
    
    # grep -E 'memory|pg space' ä»…è¾“å‡ºå¸¦æœ‰ memory å’Œ pg space çš„ä¸¤è¡Œ
    # awk å‘½ä»¤ä¸­,é¦–å…ˆåˆ¤æ–­ä¸€ä¸‹å½“å‰è¡Œæ˜¯memoryè¿˜æ˜¯pg space,å› ä¸ºpg spaceä¸­æœ‰ä¸ªç©ºæ ¼,æ­¤å¤„å äº†ä¸¤ä¸ªåŸŸ,æ‰€ä»¥å¿…é¡»å…ˆåˆ¤æ–­
    # ä¹‹åæ ¹æ®ä¸åŒæƒ…å†µ,è¾“å‡ºç»“æœå°±å¯ä»¥äº†
    # å€¼å¾—ä¸€æçš„æ˜¯,awkçš„ifæ¡ä»¶è¯­å¥ä¸shellçš„è¯­å¥æ˜¯ä¸ä¸€æ ·çš„
    # awk çš„ifæ¡ä»¶è¯­å¥æ ¼å¼:
    # if(è¡¨è¾¾å¼){
    #       è¯­å¥1
    #     }else if{
    #       è¯­å¥2
    #     }else{
    #       è¯­å¥3
    #     }
    
</code></pre></div></div>

<h4 id="ä¾‹2è·å–å½“å‰ä¸»æœºå†…å­˜å ç”¨top10çš„è¿›ç¨‹çš„idåç§°å†…å­˜å ç”¨é‡">ä¾‹2:è·å–å½“å‰ä¸»æœºå†…å­˜å ç”¨top10çš„è¿›ç¨‹çš„idã€åç§°ã€å†…å­˜å ç”¨é‡</h4>

<p>æŸ¥çœ‹è¿›ç¨‹æƒ…å†µå¯ä½¿ç”¨pså‘½ä»¤</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $ps -elf
         F S      UID     PID    PPID   C PRI NI ADDR    SZ    WCHAN    STIME    TTY  TIME CMD
    200003 A     root       1       0   0  60 20 1070187480  1688            Dec 24      -  0:00 /etc/init 
    240001 A     root 1114204  918412   0  60 20 80288480   992            Dec 24      -  0:00 /usr/bin/X11/aixconsole 
    240001 A     root 1245188       1   0  60 20 15b01db480   980            Dec 24      -  0:00 /usr/sbin/srcmstr 
    240001 A     root 1310854       1   0  60 20 2f00af590   428 f1000000a05fc098   Dec 24      -  0:00 /usr/ccs/bin/shlap64 
    240001 A     root 1638646 1377066   0  60 20 4b04cb480   940 f1000e00002a0878   Dec 24   vty2  0:00 /bin/ksh /usr/lib/assist/assist_main 
    240001 A     root 1704120 1245188   0  60 20 a00020480  2452            Dec 24      -  2:13 sendmail: accepting connections 
    40001 A     root 1769708       1   0  60 20 3702b7480   308            Dec 24      -  0:00 /opt/freeware/cimom/pegasus/bin/CIM_diagd 
    240001 A     root 1835192       1   0  60 20 3102b1480  5224 f1000a0a003be4b0   Dec 24      -  0:09 /opt/ibm/director/cimom/bin/tier1slp 
    41001 A     root 1900728       1   0  60 20 1890309480  4500            Dec 24      -  0:11 ./slp_srvreg -D 
    ......
     
    #options:
    # -e å°†é™¤å†…æ ¸è¿›ç¨‹ä»¥å¤–æ‰€æœ‰è¿›ç¨‹çš„ä¿¡æ¯å†™åˆ°æ ‡å‡†è¾“å‡ºã€‚
    # -l ç”Ÿæˆé•¿åˆ—è¡¨
    # -f ç”Ÿæˆä¸€ä¸ªå®Œæ•´åˆ—è¡¨
    
    #å­—æ®µ:
    #PID -- è¿›ç¨‹ID
    #SZ -- å†…å­˜å ç”¨é‡(å•ä½ä»æ˜¯é¡µ)
    #CMD -- å†…å­˜å
    
    #ç”±æ­¤å¯è§,é€šè¿‡pså‘½ä»¤å†åŠ ä¸Šä¸€äº›æ ¼å¼åŒ–å¤„ç†å‘½ä»¤åº”è¯¥å¯ä»¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœ
      
</code></pre></div></div>

<p>ä¸‹é¢å¼€å§‹å°è¯•è¾“å‡ºè¿›ç¨‹çš„idã€åç§°ã€å†…å­˜å ç”¨é‡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $ps -elf|sort -rn +9|head -10|awk 'BEGIN{print "PID","PNAME","SZ"}{print $4,$15,$10}'
    PID PNAME SZ
    2621660 2031:33 3885164
    1639166 ora_lgwr_rhjftst 108252
    1376752 ora_mmon_rhjftst 98324
    1245552 ora_cjq0_rhjftst 97868
    1704826 ora_dbw0_rhjftst 97824
    917888 ora_pmon_rhjftst 97660
    2687194 ora_ckpt_rhjftst 97584
    1049374 ora_smon_rhjftst 95628
    1311046 ora_dbw1_rhjftst 95232
    2752842 0:35 94932
    
</code></pre></div></div>

<p>ç»“æœè®©äººå¤±æœ›,ç”±äºå„è¡Œçš„åŸŸæ•°é‡ä¸ä¸€è‡´,å¯¼è‡´$15æ— æ³•ä¸€ç›´æŒ‡å‘è¿›ç¨‹åæ‰€åœ¨çš„åŸŸã€‚åœ¨ç»è¿‡ä¸€ç³»åˆ—å°è¯•åï¼Œä»ç„¶ä¸èƒ½å•ç”¨å‘½ä»¤å¾—åˆ°è¿›ç¨‹åï¼Œæ‰€ä»¥æ”¹ç”¨è„šæœ¬æ¥è·å–ã€‚</p>

<h4 id="ç”¨è„šæœ¬çš„æ–¹å¼è·å–">ç”¨è„šæœ¬çš„æ–¹å¼è·å–</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $vi test.sh
    
    
# !/bin/sh

    tops='';
    rst=`ps -ealf|sort -rn +9|head -10|awk '{print $4,$10/256}'`
    cnt=0

    for item in ${rst[*]}
    do
        if [[ $((cnt%2)) -eq 0 ]]
        then
            tops="${tops}${item},"`ps $item|grep -v PID|awk '{printf "%s,",$5}'`
        else
            tops="${tops}""${item}""\`"
        fi
        let cnt=$cnt+1
    done

    tops=${tops%\`}
    echo $tops
    
    # æ•´ä½“æ€è·¯æ˜¯å…ˆå¾—åˆ°top10çš„è¿›ç¨‹idå’Œæ‰€å å†…å­˜å¤§å°,å¾ªç¯é€šè¿‡idå»è·å¾—å¯¹åº”çš„è¿›ç¨‹åç§°
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    # è¾“å‡ºç»“æœ
    $./test.sh
    2621660,/altibase/bin/altibase,15176.4`1639166,ora_lgwr_rhjftst,422.859`1376752,
    ora_mmon_rhjftst,384.078`1245552,ora_cjq0_rhjftst,382.297`1704826,ora_dbw0_rhjftst,
    382.125`917888,ora_pmon_rhjftst,381.484`2687194,ora_ckpt_rhjftst,381.188`1049374,
    ora_smon_rhjftst,373.547`1311046,ora_dbw1_rhjftst,372`2752842,oraclerhjftst,370.828
    
    # ä¸ºäº†å±•ç¤ºæ•ˆæœ,ç¨å¾®è°ƒæ•´ä¸€ä¸‹æ ¼å¼
    #2621660,/altibase/bin/altibase,3885164`
    #1639166,ora_lgwr_rhjftst,108252`
    #1376752,ora_mmon_rhjftst,98324`
    #1245552,ora_cjq0_rhjftst,97868`
    #1704826,ora_dbw0_rhjftst,97824`
    #917888,ora_pmon_rhjftst,97660`
    #2687194,ora_ckpt_rhjftst,97584`
    #1049374,ora_smon_rhjftst,95628`
    #1311046,ora_dbw1_rhjftst,95232`
    #2752842,oraclerhjftst,94932
    
</code></pre></div></div>

<p>ä¸å¾—ä¸æ‰¿è®¤è¿™æ˜¯ä¸€ä¸ªç¬¨æ–¹æ³•,ä½†å¯¹äºæ•ˆç‡æ²¡æœ‰å¤šå°‘å½±å“,åœ¨æ‰¾åˆ°æ–°æ–¹æ³•ä¹‹å‰,å¯ä»¥å…ˆç”¨ç€ã€‚</p>

<h2 id="ä¸‰è·å–ç£ç›˜æ•°æ®-">ä¸‰ã€è·å–ç£ç›˜æ•°æ® <a name="disk"></a></h2>

<p>lvpså‘½ä»¤å¯ä»¥æ˜¾ç¤ºç‰©ç†å·çš„ç›¸å…³ä¿¡æ¯</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $lspv
    hdisk0          00c5cc969e7f0175                    rootvg          active
    hdisk1          00c5cc96a1c7d95e                    datavg          active
    hdisk2          00c5cc96a1c7e1a9                    datavg          active
    hdisk3          00c5cc96a1c7e863                    dicvg           active
    hdisk4          00c5cc96a1c7ef0b                    dicvg           active
    
    # å•ç‹¬ä½¿ç”¨lspvå¯ä»¥å¾—åˆ°æ‰€æœ‰ç‰©ç†å·çš„ç‰©ç†å·åç§°(pvname)ã€ç‰©ç†å·ID(pvid)ã€å·ç»„åç§°(vgname)ä»¥åŠçŠ¶æ€(status)
    
    $lspv hdisk0
    PHYSICAL VOLUME:    hdisk0                   VOLUME GROUP:     rootvg
    PV IDENTIFIER:      00c5cc969e7f0175 VG IDENTIFIER     00c5cc9600004c000000012e9e7f11e5
    PV STATE:           active                                     
    STALE PARTITIONS:   0                        ALLOCATABLE:      yes
    PP SIZE:            512 megabyte(s)          LOGICAL VOLUMES:  16
    TOTAL PPs:          558 (285696 megabytes)   VG DESCRIPTORS:   2
    FREE PPs:           414 (211968 megabytes)   HOT SPARE:        no
    USED PPs:           144 (73728 megabytes)    MAX REQUEST:      1 megabyte
    FREE DISTRIBUTION:  111..03..77..111..112                      
    USED DISTRIBUTION:  01..109..34..00..00                        
    MIRROR POOL:        None
    
    # ä½¿ç”¨lspv pvname åˆ™ä¼šæ˜¾ç¤ºè¯¥pvçš„è¯¦ç»†ä¿¡æ¯
</code></pre></div></div>

<p>ppï¼ˆphysial partitionï¼‰æ˜¯ä¸€ä¸ªç‰©ç†åˆ†åŒºï¼Œvgç”±pvç»„æˆï¼Œpvé‡Œè¾¹çš„æœ€å°åˆ†é…å•ä½å°±æ˜¯pp,pp sizeå°±æ˜¯vgé‡Œæœ€å°åˆ†é…å•ä½å¤§å°,
è¯¥ç‰©ç†å·çš„æ€»å®¹é‡=TOTAL PPS*PP SIZE/1024,å•ä½æ˜¯GBã€‚
æ‰€ä»¥,æƒ³è¦å¾—åˆ°æ‰€æœ‰ç‰©ç†å·çš„æ€»å®¹é‡ã€å·²ä½¿ç”¨é‡ã€å·²ä½¿ç”¨ç™¾åˆ†æ¯”,è¿˜æ˜¯å¾—é€šè¿‡è„šæœ¬ã€‚</p>

<h4 id="ä¾‹1ç‰©ç†å·çš„æ€»å®¹é‡å·²ä½¿ç”¨é‡å·²ä½¿ç”¨ç™¾åˆ†æ¯”">ä¾‹1:ç‰©ç†å·çš„æ€»å®¹é‡ã€å·²ä½¿ç”¨é‡ã€å·²ä½¿ç”¨ç™¾åˆ†æ¯”</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $vi test.sh
        #!/bin/sh
        
        disks=`lspv|awk '{print $1}'`
        
        for disk in $disks
        do
            printf $disk": "
            lspv $disk|sed -n '5,8p'|awk '{if(NR==1){size=$3}else if(NR==2){total=$3*size/1024}else if(NR==4){used=$3*size/1024}else{}}END{print  "æ€»å®¹é‡:"total,"å·²ä½¿ç”¨é‡"used,"å·²ä½¿ç”¨ç™¾åˆ†æ¯”"used/total}'
        done
    
    $./test.sh
    hdisk0: æ€»å®¹é‡:279 å·²ä½¿ç”¨é‡72 å·²ä½¿ç”¨ç™¾åˆ†æ¯”0.258065
    hdisk1: æ€»å®¹é‡:279 å·²ä½¿ç”¨é‡279 å·²ä½¿ç”¨ç™¾åˆ†æ¯”1
    hdisk2: æ€»å®¹é‡:279 å·²ä½¿ç”¨é‡276.5 å·²ä½¿ç”¨ç™¾åˆ†æ¯”0.991039
    hdisk3: æ€»å®¹é‡:279.25 å·²ä½¿ç”¨é‡279.25 å·²ä½¿ç”¨ç™¾åˆ†æ¯”1
    hdisk4: æ€»å®¹é‡:279.25 å·²ä½¿ç”¨é‡271 å·²ä½¿ç”¨ç™¾åˆ†æ¯”0.970457
</code></pre></div></div>

<h2 id="å››è·å–ç›®å½•æ•°æ®-">å››ã€è·å–ç›®å½•æ•°æ® <a name="dir"></a></h2>

<p>æŸ¥çœ‹ç›®å½•æƒ…å†µ,ä¸€èˆ¬ä½¿ç”¨duå‘½ä»¤
ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨é€‰é¡¹
-a	æ˜¾ç¤ºç›®å½•ä¸‹æ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶çš„ç£ç›˜ä½¿ç”¨æƒ…å†µ,ä¸-sç›¸å¯¹
-g	ç”¨ GB å•ä½ç»Ÿè®¡;
-k	ç”¨ 1024 å­—èŠ‚å•ä½ç»Ÿè®¡;
-m	ç”¨ MB å•ä½ç»Ÿè®¡;
-r	æŠ¥å‘Šä¸å¯è®¿é—®çš„æ–‡ä»¶æˆ–è€…ç›®å½•å,æ­¤ä¸ºç¼ºçœè®¾ç½®;
-s	ä»…æ˜¾ç¤ºæŒ‡å®šç›®å½•çš„æ•´ä½“ç£ç›˜ä½¿ç”¨æƒ…å†µ,ä¸æ˜¾ç¤ºå­ç›®å½•åŠæ–‡ä»¶ä½¿ç”¨æƒ…å†µ,ä¸-aç›¸å¯¹ã€‚</p>

<h4 id="ä¾‹1ä»…è·å–ç›®å½•æ•´ä½“ç£ç›˜ä½¿ç”¨æƒ…å†µç”¨gbå•ä½ç»Ÿè®¡">ä¾‹1:ä»…è·å–ç›®å½•æ•´ä½“ç£ç›˜ä½¿ç”¨æƒ…å†µ,ç”¨GBå•ä½ç»Ÿè®¡</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $du -sg $dirname
    3.65    /ngbss/crmdev/.pangu
</code></pre></div></div>

<h4 id="ä¾‹2æ˜¾ç¤ºæŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰å­ç›®å½•åŠæ–‡ä»¶ç£ç›˜ä½¿ç”¨æƒ…å†µç”¨mbå•ä½ç»Ÿè®¡">ä¾‹2:æ˜¾ç¤ºæŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰å­ç›®å½•åŠæ–‡ä»¶ç£ç›˜ä½¿ç”¨æƒ…å†µ,ç”¨MBå•ä½ç»Ÿè®¡</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $du -am $dirname
    
    ......
    0.14    /ngbss/crmdev/.pangu/test/pangu-monitor/test/main.o
    0.00    /ngbss/crmdev/.pangu/test/pangu-monitor/test/monitor.template
    8.13    /ngbss/crmdev/.pangu/test/pangu-monitor/test
    75.58   /ngbss/crmdev/.pangu/test/pangu-monitor
    0.00    /ngbss/crmdev/.pangu/test/runmon.sh
    163.58  /ngbss/crmdev/.pangu/test
    3734.79 /ngbss/crmdev/.pangu
    
    #æ­¤å‘½ä»¤ä¼šåœ¨æœ€åä¸€è¡Œæ˜¾ç¤ºæŒ‡å®šç›®å½•çš„æ•´ä½“ç£ç›˜ä½¿ç”¨æƒ…å†µ
</code></pre></div></div>

<h4 id="ä¾‹3æ˜¾ç¤ºæŒ‡å®šç›®å½•ä¸‹å¤§æ–‡ä»¶top10">ä¾‹3:æ˜¾ç¤ºæŒ‡å®šç›®å½•ä¸‹å¤§æ–‡ä»¶Top10</h4>

<p>æœ¬ä»¥ä¸ºä¼šå¾ˆç®€å•,åªè¦ä½¿ç”¨é™åº,å†å–å‰10è¡Œå°±å¯ä»¥äº†</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $du -am $dirname|sort -rn|head -10
    3734.79 /ngbss/crmdev/.pangu
    3347.17 /ngbss/crmdev/.pangu/log
    2045.48 /ngbss/crmdev/.pangu/log/4Glog-20150210
    326.80  /ngbss/crmdev/.pangu/log/134_32_28_198
    310.17  /ngbss/crmdev/.pangu/log/134_32_28_197
    300.05  /ngbss/crmdev/.pangu/log/4Glog-20150210/trade_4G_129_01.log.2015-02-10.2
    300.04  /ngbss/crmdev/.pangu/log/4Glog-20150210/trade_4G_127_01.log.2015-02-10.0
    300.02  /ngbss/crmdev/.pangu/log/4Glog-20150210/trade_4G_129_01.log.2015-02-10.1
    300.02  /ngbss/crmdev/.pangu/log/4Glog-20150210/trade_4G_129_01.log.2015-02-10.0
    300.01  /ngbss/crmdev/.pangu/log/4Glog-20150210/trade_4G_127_01.log.2015-02-10.2
    
</code></pre></div></div>

<p>ç„¶è€Œå¹¶ä¸æ˜¯,ä¸Šé¢çš„ç»“æœé™¤äº†æ–‡ä»¶,è¿˜åŒ…å«ç€ç›®å½•ã€‚
å¦‚æœæƒ³è¦åªè¾“å‡ºæ–‡ä»¶,å¿…é¡»å¦å¯»ä»–æ³•ã€‚
å°è¯•è¿‡å…¶ä»–å¾ˆå¤šæ–¹æ³•,æ¯”å¦‚find,æ¯”å¦‚ls,è™½ç„¶èƒ½è¾¾åˆ°æƒ³è¦çš„ç»“æœ,ä½†æ˜¯æ‰§è¡Œæ•ˆç‡éƒ½ä¸é«˜,æ²¡æœ‰duæ¥å¾—å¿«,è‹¥æƒ³ç”¨du,å…³é”®åœ¨äºåˆ¤æ–­è¯¥è¡Œåœ°å€æ˜¯å¦æ˜¯ç›®å½•ã€‚
è§‚å¯Ÿæ•´ä¸ªå‘½ä»¤æµç¨‹,æœ€æœ‰å¯èƒ½å¯ä»¥åˆ¤æ–­çš„åœ°æ–¹åªèƒ½æ˜¯åœ¨awkç¯èŠ‚ã€‚
äºæ˜¯ç ”ç©¶äº†awkçš„ç”¨æ³•å,å‘ç°awkçš„â€™{}â€™ä¸­,æ˜¯å¯ä»¥å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤åŠshellå‘½ä»¤çš„ã€‚
é€šè¿‡system(cmd)ç»“åˆgetline[var]ä¾¿å¯ä»¥å®ç°ã€‚
äºæ˜¯â€¦â€¦</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $du -am $dirname|sort -rn|awk '{cmd="test -d "$2";echo $?";cmd|getline rst;if(rst==1){print "è·¯å¾„: "$2 ,"å ç”¨ç©ºé—´"$1"MB"}}'|head -10
    è·¯å¾„: /ngbss/crmdev/.pangu/log/4Glog-20150210/trade_4G_129_01.log.2015-02-10.2 æ–‡ä»¶å¤§å°: 300.05MB
    è·¯å¾„: /ngbss/crmdev/.pangu/log/4Glog-20150210/trade_4G_127_01.log.2015-02-10.0 æ–‡ä»¶å¤§å°: 300.04MB
    è·¯å¾„: /ngbss/crmdev/.pangu/log/4Glog-20150210/trade_4G_129_01.log.2015-02-10.1 æ–‡ä»¶å¤§å°: 300.02MB
    è·¯å¾„: /ngbss/crmdev/.pangu/log/4Glog-20150210/trade_4G_129_01.log.2015-02-10.0 æ–‡ä»¶å¤§å°: 300.02MB
    è·¯å¾„: /ngbss/crmdev/.pangu/log/4Glog-20150210/trade_4G_127_01.log.2015-02-10.2 æ–‡ä»¶å¤§å°: 300.01MB
    è·¯å¾„: /ngbss/crmdev/.pangu/log/4Glog-20150210/trade_4G_127_01.log.2015-02-10.1 æ–‡ä»¶å¤§å°: 300.01MB
    è·¯å¾„: /ngbss/crmdev/.pangu/log/trade_4G_127_01.log æ–‡ä»¶å¤§å°: 170.82MB
    è·¯å¾„: /ngbss/crmdev/.pangu/log/4Glog-20150210/trade_4G_127_01.log.2015-02-10.3 æ–‡ä»¶å¤§å°: 124.88MB
    è·¯å¾„: /ngbss/crmdev/.pangu/log/134_32_28_198/tux20141228.log æ–‡ä»¶å¤§å°: 122.79MB
    è·¯å¾„: /ngbss/crmdev/.pangu/log/4Glog-20150210/trade_4G_129_01.log.2015-02-10.3 æ–‡ä»¶å¤§å°: 120.45MB
</code></pre></div></div>

<p>ç»ˆäºå¾—åˆ°äº†æœŸæœ›çš„è¾“å‡ºç»“æœã€‚</p>
:ET