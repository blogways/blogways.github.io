I"¼-<p>Â Â Â Â Â Â Â Â é€šè¿‡å‰ä¸¤ç¯‡æ–‡ç« æˆ‘ä»¬çŸ¥é“äº†å¦‚ä½•éƒ¨ç½²Elasticsearchä»¥åŠå®ƒçš„ä¸€äº›ç®€å•æ“ä½œï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¨¡æ‹Ÿä¸€äº›æ•°æ®è¿›è¡Œæ“ä½œç»ƒä¹ ï¼Œæ¯ä¸€ä¸ªæ•°æ®åŒ…å«ä¸ªä½“çš„idã€å¹´é¾„ã€æ€§åˆ«ã€åœ°å€ã€é‚®ç®±ç­‰ä¿¡æ¯ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{  
    "acctId": 1,  
    "age": 18,  
    "gender": "M",  
    "balance": 10000000,  
    "address": "ä¸­å›½æ±Ÿè‹å—äº¬",  
    "email": "test@test.com",  
    "city": "nj",  
    "state": "js"  
}
</code></pre></div></div>
<p>Â Â Â Â Â Â Â Â é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡ŒåŠ è½½åˆ°æˆ‘ä»¬åˆ°æœåŠ¡ä¸­ï¼Œå…¶ä¸­person.jsonæ˜¯æˆ‘ä»¬æ¨¡æ‹Ÿåˆ°æ•°æ®ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XPOST 'localhost:9200/person/acct/_bulk?pretty&amp;refresh' -H 'Content-Type:application/json' --data-binary "@person.json"
</code></pre></div></div>
<p>åœ¨é€šè¿‡curl â€˜localhost:9200/_cat/indices?vâ€™æŸ¥çœ‹ç´¢å¼•ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>health status index    uuid                   pri rep docs.count docs.deleted store.size pri.store.size  
yellow open   person   7rAoSSNZQRqtyDb56wR3fQ   5   1       1000            0      474kb          474kb  
yellow open   god      z-R0aYrcTTSCTI4ZdbPv3Q   5   1          1            0      4.4kb          4.4kb  
</code></pre></div></div>
<p>å…¶ä¸­personæ˜¯æˆ‘ä»¬åˆšåˆšæ·»åŠ åˆ°1000æ•°æ®ï¼Œæ•°æ®å¤§å°ä¸º474kb.<br />
æˆ‘ä»¬ç”¨åˆ†curlå‘½ä»¤å’Œhttpè¯·æ±‚æŸ¥çœ‹ã€‚<br />
Â Â Â Â <strong>1ï¼‰httpæ–¹å¼ï¼š</strong><code class="language-plaintext highlighter-rouge">http://47.104.94.172:9200/person/_search?q=*&amp;sort=acctId:asc&amp;pretty</code><br />
Â Â Â Â <strong>2ï¼‰curlæ–¹å¼ï¼š</strong><code class="language-plaintext highlighter-rouge">curl -XGET 'localhost:9200/person/_search?q=*&amp;sort=acctId:asc&amp;pretty&amp;pretty'</code><br />
Â Â Â Â Â Â Â Â åœ¨è¿™é‡Œä½¿ç”¨ _search ç«¯ç‚¹ï¼Œç„¶å q=*ï¼ˆqä¸ºqueryçš„ç¼©å†™ï¼‰ å‚æ•°å‘½ä»¤ElasticsearchåŒ¹é…ç´¢å¼•ä¸­çš„å…¨éƒ¨æ–‡æ¡£ã€‚sort=acctId:asc å‚æ•°è¡¨ç¤ºæŒ‰ acctId å±æ€§å‡åºæ’åˆ—è¿”å›çš„ç»“æœã€‚pretty å‚æ•°å°†è¿”å›ç»“æœä»¥ç¾è§‚çš„æ ¼å¼è¿”å›ã€‚<br />
è¿”å›ç»“æœé»˜è®¤10æ¡ï¼Œä¸‹é¢ä¸ºæˆ‘ä»¬æˆªå–å¼€å¤´ä»¥åŠä¸€æ¡æ•°æ®ï¼š  ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{  
  "took" : 219,  
  "timed_out" : false,  
  "_shards" : {  
    "total" : 5,  
    "successful" : 5,  
    "skipped" : 0,  
    "failed" : 0  
  },  
  "hits" : {  
    "total" : 1000,  
    "max_score" : null,  
    "hits" : [  
      {  
        "_index" : "person",  
        "_type" : "acct",  
        "_id" : "0",  
        "_score" : null,  
        "_source" : {  
          "acctId" : 0,  
          "age" : 24,  
          "gender" : "F",  
          "address" : "ä¸­å›½ä¸Šæµ·",  
          "balance" : 9999,  
          "email" : "qqq@qq.com",  
          "city" : "sh",  
          "state" : "sh"  
        },  
        "sort" : [  
          0  
        ]  
      },{........} 
</code></pre></div></div>
<p>è¿”å›ç»“æœå‚æ•°è§£é‡Šï¼š<br />
Â Â Â Â <strong>took :</strong> Elasticsearchæ‰§è¡ŒæŸ¥è¯¢æ‰€ç”¨çš„æ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰
Â Â Â Â <strong>timed_out :</strong> æ˜¯å¦è¶…æ—¶<br />
Â Â Â Â <strong>_shards : **æœç´¢çš„åˆ†ç‰‡æ•°é‡ï¼Œå®ƒçš„å‚æ•°åŒ…å«æ€»æ•°ã€æˆåŠŸå’Œå¤±è´¥çš„åˆ†ç‰‡æ•°<br />
Â Â Â Â </strong>hits :** æœç´¢ç»“æœ<br />
Â Â Â Â <strong>hits.total :</strong> ç¬¦åˆæœç´¢æ¡ä»¶çš„æ–‡æ¡£æ•°é‡<br />
Â Â Â Â <strong>hits.hits :</strong> å®é™…è¿”å›çš„æœç´¢ç»“æœå¯¹è±¡æ•°ç»„(é»˜è®¤åªè¿”å›å‰10æ¡)<br />
Â Â Â Â <strong>hits.sort :</strong>  è¿”å›ç»“æœçš„æ’åºå­—æ®µå€¼(å¦‚æœæ˜¯æŒ‰scoreè¿›è¡Œæ’åºï¼Œåˆ™æ²¡æœ‰)<br />
Â Â Â Â <strong>hits._score ï¼š</strong>è¿”å›æ–‡æ¡£çš„åŒ¹é…å¾—åˆ†ï¼ˆå¾—åˆ†è¶Šé«˜ï¼ŒåŒ¹é…ç¨‹åº¦è¶Šé«˜ï¼Œè¶Šé å‰ï¼‰<br />
Â Â Â Â <strong>hits.max_score :</strong> æœ€å¤§åŒ¹é…å¾—åˆ†<br />
æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è¯·æ±‚ä½“çš„æ–¹å¼ï¼š
<img src="/images/chenlong/e14.png" alt="e14.png" /><br />
æˆ–è€…curlå‘½ä»¤çš„è¯·æ±‚ä½“æ–¹å¼ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XPOST 'localhost:9200/person/_search?pretty' -H 'Content-Type:application/json' -d '  
{  
  "query":{"match_all":{}},  
  "sort":[  
    {"acctId":"asc"}  
   ]  
}  
' 
</code></pre></div></div>
<p>Â Â Â Â Â Â Â Â æŸ¥è¯¢çš„æ€è·¯ç±»ä¼¼äºsqlã€‚queryå®šä¹‰æŸ¥è¯¢ï¼Œmatch_allå…¨åŒ¹é…å³åœ¨ç´¢å¼•ä¸­æœç´¢æ‰€æœ‰çš„æ–‡æ¡£ã€‚åœ¨æœªæŒ‡å®šsizeçš„æ—¶å€™é»˜è®¤æŸ¥è¯¢10æ¡æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡å®šä¹‰sizeæ¥æ§åˆ¶è¿”å›æ•°æ®çš„å¤šå°‘ã€‚ä¹Ÿå¯ä»¥é€šè¿‡fromå’Œsizeæ¥æŒ‡å®šè¿”å›ç»“æœå¼€å§‹å’Œå¤§å°ï¼Œå¦‚è¿”å›20-40:<img src="/images/chenlong/e15.png" alt="e15.png" /><br />
curlå‘½ä»¤ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XPOST 'localhost:9200/person/_search?pretty' -H 'Content-Type:application/json' -d '  
{  
  "query":{"match_all":{}},  
  "sort":[  
    {"acctId":"asc"}  
   ],  
   "from":20,  
   "size":20  
}  
' 
</code></pre></div></div>
<p>Â Â Â Â Â Â Â Â å¯¹äºæ’åºï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šæŸä¸ªå­—æ®µæ’åºä¹‹ååœ¨è¿”å›ç»“æœï¼Œä¾‹å¦‚å…ˆæ ¹æ®ä¸ªä½“çš„æ”¶å…¥æ’åºä¹‹ååœ¨è¿”å›å‰30æ¡æ•°æ®ï¼š
<img src="/images/chenlong/e16.png" alt="e16.png" /><br />
curlå‘½ä»¤:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XPOST 'localhost:9200/person/_search?pretty' -H 'Content-Type:application/json' -d '  
{  
  "query":{"match_all":{}},  
  "sort":{"balance":{"order":"asc"}},  
   "size":30  
}  
' 
</code></pre></div></div>
<p>Â Â Â Â Â Â Â Â é€šè¿‡ä¸Šé¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºElasticsearchæä¾›äº†ä¸€ç§JSONæ ¼å¼çš„é¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆQuery DSLï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥æ‰§è¡ŒæŸ¥è¯¢ã€‚åœ¨ä¸Šé¢æˆ‘ä»¬å·²ç»è¿›è¡Œäº†ç®€å•çš„ä½¿ç”¨ï¼Œä¸‹é¢æˆ‘ä»¬åœ¨ç›¸å¯¹æ·±å…¥ä¸€ç‚¹å­¦ä¹ ä¸€ä¸‹è¿™é—¨è¯­è¨€ã€‚<br />
Â Â Â Â Â Â Â Â åœ¨ä¹‹å‰çš„æŸ¥è¯¢ç»“æœä¸­ï¼Œå¯ä»¥çœ‹å‡º_sourceåŒ…å«äº†æ‰€æœ‰å±æ€§ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åªè¦æ±‚å‡ºæŸ¥è¯¢50-80çš„acctId,ageå’Œgenderä¸‰ä¸ªå±æ€§:<br />
<img src="/images/chenlong/e17.png" alt="e17.png" /><br />
curlå‘½ä»¤ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XPOST 'localhost:9200/person/_search?pretty' -H 'Content-Type:application/json' -d '  
{  
  "query":{"match_all":{}},  
  "_source":["acctId","age","gender"],  
    "from":50,  
   "size":30  
}  
'
</code></pre></div></div>
<p>Â Â Â Â Â Â Â Â å¯¹äºç²¾ç¡®æŸ¥æ‰¾match_allä¼¼ä¹å·²ç»ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨matchæ¥è¿›è¡ŒæŸ¥æ‰¾ã€‚ä¾‹å¦‚æŸ¥æ‰¾ageä¸º24çš„ä¸ªä½“ï¼š<br />
<img src="/images/chenlong/e18.png" alt="e18.png" /><br />
curlå‘½ä»¤ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XGET 'localhost:9200/person/_search?pretty' -H 'Content-Type:application/json' -d '  
{  
"query":{"match":{"age":24}}  
}  
' 
</code></pre></div></div>
<p>Â Â Â Â Â Â Â Â æŸ¥è¯¢emailå«æœ‰qq.comçš„ä¿¡æ¯ï¼š<br />
<img src="/images/chenlong/e19.png" alt="e19.png" /><br />
curlå‘½ä»¤ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XGET 'localhost:9200/person/_search?pretty' -H 'Content-Type:application/json' -d '  
{  
"query":{"match":{"email": "@qq.com"}}  
}  
' 
</code></pre></div></div>
<p>Â Â Â Â Â Â Â Â æŸ¥è¯¢emailå«æœ‰@qq.comæˆ–@163.comçš„ä¿¡æ¯ï¼š
<img src="/images/chenlong/e20.png" alt="e20.png" /><br />
curlå‘½ä»¤ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XGET 'localhost:9200/person/_search?pretty' -H 'Content-Type:application/json' -d '  
{  
"query":{"match":{"email": "@qq.com @163.com"}}  
}  
' 
</code></pre></div></div>
<p>Â Â Â Â Â Â Â Â å¦å¤–ï¼Œmatchè¿˜æœ‰å«åšmatch_phraseçš„äº²æˆšï¼Œè¿™ä¸ªäº²æˆšå¯ä»¥å¸®æˆ‘ä»¬æŸ¥å¤„åŒ…å«â€œä¸­å›½æ±Ÿè‹â€çš„æ‰€æœ‰æ–‡æ¡£ï¼š<br />
<img src="/images/chenlong/e21.png" alt="e21.png" /><br />
curlå‘½ä»¤ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XGET 'localhost:9200/person/_search?pretty' -H 'Content-Type:application/json' -d '  
{  
"query":{"match_phrase": { "address": "ä¸­å›½æ±Ÿè‹" }}  
}  
' 
</code></pre></div></div>
<p>Â Â Â Â Â Â Â Â ä»‹ç»å®Œmatch_full, match_phrase, matchä¹‹åï¼Œæˆ‘ä»¬åœ¨ä»‹ç»ä¸€ä¸ªboolæŸ¥è¯¢ï¼Œè¯¥æŸ¥è¯¢å…è®¸ä½¿ç”¨å¸ƒå°”é€»è¾‘å°†å°çš„æŸ¥è¯¢ç»„æˆå¤§çš„æŸ¥è¯¢ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬æŸ¥è¯¢addrssåŒ…å«â€œæ±Ÿè‹â€ï¼Œâ€œå—äº¬â€çš„æ–‡æ¡£ä¿¡æ¯ï¼š
<img src="/images/chenlong/e22.png" alt="e22.png" /><br />
curlå‘½ä»¤ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XPOST 'localhost:9200/person/_search?pretty' -H 'Content-Type:application/json' -d '  
{  
  "query":{  
     "bool":{  
        "must":[  
             {"match":{"address":"æ±Ÿè‹"}},  
             {"match":{"address":"å—äº¬"}}  
         ]  
     }  
  }  
}  
'  
</code></pre></div></div>
<p>Â Â Â Â Â Â Â Â åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œboolå’Œmustç»„æˆæ¥ä¸€ä¸ªæ–‡æ¡£çš„å¿…å¤‡æ¡ä»¶ï¼Œæœ‰ç‚¹ç±»ä¼¼ä¸sqlè¯­å¥çš„å¤šæ¡ä»¶æŸ¥è¯¢ï¼Œé‚£ä¹ˆå‡å¦‚è¦æŸ¥è¯¢æˆ–çš„å…³ç³»æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å°†ä¸Šé¢çš„ä¾‹å­ä¸­çš„mustæ¢æˆshouldå³å¯ã€‚boolå’Œshouldåªè¦æ»¡è¶³ä¸€ä¸ªæ¡ä»¶å³å¯ã€‚<br />
Â Â Â Â Â Â Â Â ä½†æ˜¯å‡å¦‚æˆ‘ä»¬æŸ¥è¯¢çš„æ—¶å€™éœ€è¦å¤šæ¡ä»¶ä¸æ»¡è¶³æ—¶å°±éœ€è¦ç”¨åˆ°boolå’Œmust_notäº†ï¼Œå¦‚æŸ¥è¯¢æ—¢ä¸åŒ…å«â€œæ±Ÿè‹â€ä¹Ÿä¸åŒ…å«â€œå±±ä¸œâ€çš„æ–‡æ¡£ä¿¡æ¯ï¼š<br />
<img src="/images/chenlong/e23.png" alt="e23.png" /><br />
curlå‘½ä»¤ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XPOST 'localhost:9200/person/_search?pretty' -H 'Content-Type:application/json' -d '  
{  
  "query":{  
     "bool":{  
        "must_not":[  
             {"match":{"address":"æ±Ÿè‹"}},  
             {"match":{"address":"å±±ä¸œ"}}  
         ]  
     }  
  }  
}  
'  
</code></pre></div></div>
<p>Â Â Â Â Â Â Â Â åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠmustå’Œmust_notåšä¸€ä¸‹ç»„åˆï¼ŒæŸ¥è¯¢addresså«æœ‰â€œä¸­å›½æ±Ÿè‹â€ä½†æ˜¯ageä¸ç­‰äº30çš„æ–‡æ¡£ä¿¡æ¯ï¼š<br />
<img src="/images/chenlong/e24.png" alt="e24.png" /><br />
curlå‘½ä»¤ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XPOST 'localhost:9200/person/_search?pretty' -H 'Content-Type:application/json' -d '  
{  
  "query":{  
     "bool":{  
        "must":[  
                 {"match":{"address": "ä¸­å›½æ±Ÿè‹"}}  
         ],  
         "must_not":[  
                  {"match":{"age":30}}    
         ]  
     }  
  }  
}  
'   
</code></pre></div></div>
<p>Â Â Â Â Â Â Â Â å…³äºboolç»„åˆfilterèµ·åˆ°è¿‡æ»¤çš„ä½œç”¨ã€‚æŸ¥è¯¢ageåœ¨20-33ä¹‹é—´çš„æ–‡æ¡£ä¿¡æ¯ï¼š<br />
<img src="/images/chenlong/e25.png" alt="e25.png" /><br />
curlå‘½ä»¤ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XPOST 'localhost:9200/person/_search?pretty' -H 'Content-Type:application/json' -d '  
{  
  "query":{  
    "bool":{  
      "must":{"match_all":{}},  
      "filter":{  
        "range":{  
          "age":{  
            "gte":20,  
            "lte":33  
          }  
        }  
      }  
    }  
  }  
}  
'  
</code></pre></div></div>
<p>Â Â Â Â Â Â Â Â åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­boolæŸ¥è¯¢åœ¨æŸ¥è¯¢éƒ¨åˆ†ä½¿ç”¨match_allï¼Œåœ¨è¿‡æ»¤éƒ¨åˆ†ä½¿ç”¨rangeã€‚å¯ä»¥ä½¿ç”¨ä»»ä½•çš„æŸ¥è¯¢æ¥ä»£æ›¿æŸ¥è¯¢éƒ¨åˆ†å’Œè¿‡æ»¤éƒ¨åˆ†ã€‚</p>

:ET