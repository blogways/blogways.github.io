I"¶%<h3 id="ä¸€gitoliteå®ç°åŠŸèƒ½">ä¸€ã€gitoliteå®ç°åŠŸèƒ½</h3>

<p>1.é€šè¿‡è¿œç¨‹è¿æ¥èƒ½å¤Ÿå¯¹æœåŠ¡å™¨ä¸Šä»“åº“è¿›è¡Œè¯»å†™æ“ä½œï¼›</p>

<p>2.å®‰å…¨çš„æƒé™ç®¡ç†ï¼Œæ§åˆ¶ç‰¹å®šç”¨æˆ·åªèƒ½è®¿é—®ä»“åº“ï¼Œå¹¶èƒ½é™åˆ¶è¯»å†™æƒé™;</p>

<p>3.æƒé™æ§åˆ¶ä¸åªä½œç”¨äºä»“åº“ï¼Œè€ŒåŒæ ·äºä»“åº“ä¸­çš„æ¯ä¸ªbranchå’Œtag nameã€‚</p>

<h3 id="äºŒgitoliteå®‰è£…">äºŒã€gitoliteå®‰è£…</h3>
<p>Gitolite æ˜¯ä¸€æ¬¾ Perl è¯­è¨€å¼€å‘çš„ Git æœåŠ¡ç®¡ç†å·¥å…·ï¼Œé€šè¿‡å…¬é’¥å¯¹ç”¨æˆ·è¿›è¡Œè®¤è¯ï¼Œå¹¶èƒ½å¤Ÿé€šè¿‡é…ç½®æ–‡ä»¶å¯¹å†™æ“ä½œè¿›è¡ŒåŸºäºåˆ†æ”¯å’Œè·¯å¾„çš„çš„ç²¾ç»†æˆæƒã€‚Gitolite é‡‡ç”¨çš„æ˜¯ SSH åè®®å¹¶ä¸”ä½¿ç”¨ SSH å…¬é’¥è®¤è¯ï¼Œä»¥ä¸‹ä¸ºå®‰è£…å‰ææ¡ä»¶ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	UNIX/LINUXæ“ä½œç³»ç»Ÿ
	shellç¯å¢ƒ
	git 1.6.6+
	perl 5.8.8+
	openssh 5.0+ï¼ˆå¥½åƒä½äºè¿™ä¸ªç‰ˆæœ¬ä¹Ÿè¡Œï¼‰
	gitoliteä½¿ç”¨çš„è´¦å·ï¼ˆæœ¬æ–‡ç”¨çš„gitï¼‰
</code></pre></div></div>

<ol>
  <li>ä»¥gitè´¦å·ç™»å…¥ä¸»æœºï¼›</li>
  <li>ç¡®ä¿~/.ssh/authorized_keysä¸ºç©ºæˆ–ä¸å­˜åœ¨ï¼›</li>
  <li>ä¸»æœºä¸Šæ‰§è¡Œgit clone  https://github.com/sitaramc/gitolite.gitï¼ˆä¸èƒ½ä¸Šç½‘å¯ä¸Šä¼ å®ç°ï¼‰ï¼›</li>
  <li>mkdir -p /home/git/bin</li>
  <li>./gitolite/install -to /home/git/bin/</li>
  <li>é€‰æ‹©ä¸€å°æœºå™¨ä½œä¸ºclientæœºå™¨ï¼ˆæˆ‘è¿™é‡Œå°±é€‰æ‹©æœ¬æœºï¼‰ï¼Œå¹¶å°†è¿™å°å®¢æˆ·ç«¯æœºå™¨çš„å…¬é’¥ä¸Šä¼ å¹¶ä¿å­˜åœ¨ä¸»æœºçš„/home/git/YourName.pubï¼ˆæˆ‘è¿™é‡Œç”¨çš„æˆ‘æœ¬æœºçš„ï¼Œèµ·åtangsz.pubï¼‰ä½ç½®</li>
  <li>
    <p>~/bin/gitolite setup -pk ~/YourName.pub
8.æµ‹è¯•å®‰è£…æ˜¯å¦æˆåŠŸ</p>

    <p>æœ¬æœº(windowsè¦åˆ°git Bashä¸‹æ‰§è¡Œ)æ‰§è¡Œssh git@10.20.16.78æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  hello git, this is git@slave2 running gitolite3 v3.6.3-10-g4be7ac5-dt on git 1.8.1.6
 
  R W    gitolite-admin
  R W    testing
</code></pre></div>    </div>
  </li>
</ol>

<p>æ³¨ï¼šå®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼š</p>

<ol>
  <li>
    <p>/gitolite/install: /usr/bin/perl^M: bad interpreter: No such file or directory</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> è§£å†³:install æ–‡ä»¶è½¬unixæ ¼å¼
</code></pre></div>    </div>
  </li>
  <li>
    <p>git describe failed; cannot deduce version number</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> è§£å†³ï¼šç”±äºä¸»æœºä¸èƒ½ä¸Šç½‘ï¼Œæˆ‘æ˜¯æŠŠæ–‡ä»¶copyåˆ°ä¸»æœºï¼Œç„¶åå»ºç«‹ä»“åº“çš„ï¼Œè¿™æ ·ä¸è¡Œï¼Œå¯ä»¥æŠŠæœ¬åœ°ä¸‹è½½çš„å¸¦.gitç›®å½•çš„æ–‡ä»¶ç›´æ¥ä¸Šä¼ ä¸»æœºã€‚
</code></pre></div>    </div>
  </li>
  <li>
    <p>WARNING: Canâ€™t exec â€œ/data/git/bin/triggers/post-compile/ssh-authkeysâ€: No such file or directory at /data/git/bin/lib/Gitolite/Common.pm line 146, <DATA> line 1.</DATA></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> è§£å†³ï¼šdos2unix /data/git/bin/triggers/post-compile/*
</code></pre></div>    </div>
  </li>
  <li>
    <p>ssh git@10.20.16.78 æŠ¥é”™ï¼šWARNING: Canâ€™t exec â€œ/data/git/sbin/commands/infoâ€: No such file or directory</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> è§£å†³ï¼šdos2unix /data/git/sbin/commands/info
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="ä¸‰gitoliteæ·»åŠ ç”¨æˆ·å’Œä»“åº“">ä¸‰ã€gitoliteæ·»åŠ ç”¨æˆ·å’Œä»“åº“</h3>
<ol>
  <li>
    <p>clone ç®¡ç†ä»“åº“gitolite-adminï¼ˆæˆ‘æœ¬æœºæ“ä½œï¼‰ï¼š</p>

    <ul>
      <li>
        <p>git clone git@server-host:gitolite-admin ï¼ˆå¦‚ï¼šgit clone git@10.20.16.78:gitolite-admin.gitï¼‰</p>
      </li>
      <li>
        <p>gitolite-adminæœ‰confå’Œkeydirä¸¤ä¸ªå­æ–‡ä»¶å¤¹ï¼Œkeydiræ–‡ä»¶å¤¹å°±æ˜¯ç®¡ç†ç”¨æˆ·å…¬é’¥çš„åœ°æ–¹ï¼Œå¦‚æœæœ‰ä¸€ä½æ–°ç”¨æˆ·ï¼ˆspdoopï¼‰å¸Œæœ›ç”³è¯·è´¦æˆ·å¹¶ç”³è¯·ä¸€ä¸ªæ–°çš„ä»£ç ä»“åº“ï¼ˆä»£ç ä»“åº“å«åštestï¼‰ï¼Œé‚£ä¹ˆè®©ä»–æä¾›ä»–çš„è´¦å·ã€ä»–ç”¨çš„ç”µè„‘çš„å…¬é’¥ç»™gitç®¡ç†å‘˜ï¼ˆå¯ä»¥é€šè¿‡email/qqç­‰æ–¹å¼ï¼‰ï¼Œç„¶åç”±gitç®¡ç†å‘˜åœ¨keydirä¸‹åˆ›å»ºspdoop.pubæ–‡ä»¶å¹¶å°†å…¬é’¥å†…å®¹å¤åˆ¶å…¶ä¸­ã€‚</p>
      </li>
      <li>
        <p>conf/gitolite.confè®¾ç½®æƒé™æ–‡ä»¶ï¼š</p>
      </li>
    </ul>

 		repo test
  			RW+ = spdoop

    <ul>
      <li>
        <p>æ·»åŠ å®Œé…ç½®åå°†æœ¬åœ°ä»“åº“ä¿®æ”¹pushåˆ°æœåŠ¡å™¨ä»“åº“ï¼ŒæœåŠ¡ä¼šè‡ªåŠ¨åˆ›å»ºä»“åº“testï¼ˆå½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥è‡ªå·±å…ˆåˆ°ä¸»æœºä¸Šå»ºä»“åº“ï¼Œgitoliteç®¡ç†çš„ä»“åº“éƒ½åœ¨ç”¨æˆ·ç›®å½•repositoriesä¸‹ï¼Œä¹Ÿå¯ä¿®æ”¹é…ç½®ï¼‰ï¼Œspdoopå…·æœ‰è¯»å†™æƒé™ã€‚</p>
      </li>
      <li>
        <p>å¦‚æœæƒ³æ·»åŠ spdoopä¸ºç®¡ç†å‘˜ï¼Œéœ€ç®¡ç†å‘˜tangszä¿®æ”¹gitolite.conf</p>
      </li>
    </ul>

 		repo gitolite-admin
 			RW+     =   git tangsz 
  </li>
</ol>

<p>æ³¨ï¼špushè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. error: cannot run hooks/update: No such file or directory è§£å†³æ–¹æ³•ï¼š æ­¤é—®é¢˜æˆ‘æ˜¯åœ¨windowsæœºå™¨ä¼ gitoliteæºç åˆ°linuxæœºå™¨ä¸Šå®‰è£…å‡ºç°çš„ï¼Œlinuxã€macä¸çŸ¥é“ä¼šä¸ä¼šå‡ºç°ï¼Œæ‰¾äº†å¥½ä¹…æ‰å‘ç°è¦å°†updateã€post-updateç­‰æ–‡ä»¶dos2unixã€‚å…·ä½“å‘½ä»¤ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š

cd ~/.gitolite/hooks/common
dos2unix *
cd ~/.gitolite/hooks/gitolite-admin
dos2unix *
</code></pre></div></div>

<h3 id="å››gitoliteé…ç½®å®ä¾‹">å››ã€gitoliteé…ç½®å®ä¾‹</h3>

<p>è¿™é‡Œå¯¹gitoliteè¯¦ç»†çš„æƒé™é…ç½®å°±ä¸åšè¯´æ˜ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„å®ä¾‹ä»‹ç»ä¸‹gitoliteçš„ä½¿ç”¨ï¼š</p>

<ol>
  <li>
    <p>æ·»åŠ æ–°çš„ä»“åº“pangu-la-webï¼Œç®¡ç†å‘˜tangszå…·æœ‰è¯»å†™ã€å¼ºåˆ¶pushæ“ä½œæƒé™ï¼š</p>

    <ul>
      <li>
        <p>ä¿®æ”¹gitolite.conf</p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	repo pangu-la-web
 			RW+     =   tangsz
</code></pre></div>        </div>
      </li>
      <li>
        <p>æäº¤æœ¬åœ°ä»“åº“å¹¶pushåˆ°æœåŠ¡å™¨</p>
      </li>
      <li>
        <p>æŸ¥çœ‹ä¸»ä»“åº“å·²ç»å»ºç«‹ç©ºä»“åº“pangu-la-web</p>
      </li>
      <li>
        <p>æœ¬æœºcloneä¸‹pangu-la-webä»“åº“ï¼ˆgit clone git@10.20.16.78:pangu-la-webï¼‰</p>
      </li>
      <li>
        <p>æ·»åŠ æ–‡ä»¶testï¼Œpushåˆ°æœåŠ¡å™¨ä»“åº“masteråˆ†æ”¯</p>
      </li>
    </ul>
  </li>
  <li>
    <p>ç”¨æˆ·spdoopæ·»åŠ pangu-la-webä¸­devå¼€å¤´çš„åˆ†æ”¯æœ‰è¯»/å†™/å¼ºåˆ¶æ›´æ–°çš„æƒé™ï¼Œteståˆ†æ”¯ï¼ˆä¸¥æ ¼åŒ¹é…ï¼‰å…·æœ‰è¯»/å†™æƒé™</p>

    <ul>
      <li>
        <p>ä¿®æ”¹gitolite.conf</p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  repo pangu-la-web
      RW+     =   tangsz
      RW+     dev       =   spdoop
      RW      test$     =   spdoop
</code></pre></div>        </div>
      </li>
      <li>
        <p>æäº¤å¹¶pushåˆ°æœåŠ¡å™¨ä»“åº“</p>
      </li>
      <li>
        <p>spdoop clone pangu-la-webä»“åº“åˆ°æœ¬åœ°ï¼Œä¿®æ”¹testï¼Œæ‰§è¡Œgit push origin masteråé”™è¯¯å¦‚ä¸‹ï¼ˆæ²¡æœ‰æƒé™æäº¤masterï¼‰ï¼š</p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  remote: FATAL: W refs/heads/master pangu-la-web spdoop DENIED by fallthru
</code></pre></div>        </div>
      </li>
      <li>
        <p>spdoopæ–°å»ºåˆ†æ”¯dev1ï¼ˆgit branch dev1ï¼‰ checkoutåˆ°dev1åˆ†æ”¯ï¼ˆgit checkout dev1ï¼‰ï¼Œæ‰§è¡Œgit push origin dev1æˆåŠŸ</p>
      </li>
      <li>
        <p>spdoopæ–°å»ºåˆ†æ”¯testï¼ˆgit branch testï¼‰ checkoutåˆ°teståˆ†æ”¯ï¼ˆgit checkout testï¼‰ï¼Œæ‰§è¡Œgit push origin testæˆåŠŸ</p>
      </li>
    </ul>
  </li>
  <li>
    <p>è¿™é‡Œç”¨æˆ·spdevè¯•å›¾cloneä»“åº“pangu-la-webï¼ˆgit clone git@10.20.16.78:pangu-la-webï¼‰ï¼Œå‡ºç°é”™è¯¯å¦‚ä¸‹ï¼š</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    fatal: 'pangu-la-web' does not appear to be a git repository
    fatal: Could not read from remote repository.	
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="äº”å¤–éƒ¨äººå‘˜å‚ä¸ç°æœ‰é¡¹ç›®å¼€å‘æ¡ä»¶">äº”ã€å¤–éƒ¨äººå‘˜å‚ä¸ç°æœ‰é¡¹ç›®å¼€å‘æ¡ä»¶</h3>

<ol>
  <li>
    <p>ä¿è¯æœ¬æœºç”µè„‘å®‰è£…äº†gitï¼Œwindowsä¸‹å®‰è£…çš„æ˜¯msysgitï¼ˆwindowså®‰è£…åä¼šç”Ÿæˆgit Bashå‘½ä»¤çª—å£ï¼‰ï¼Œå…¶ä¸­gitå®‰è£…å¯ä»¥å‚é˜…æœ¬åšå®¢gitç¯‡ï¼›</p>
  </li>
  <li>
    <p>å‘½ä»¤çª—å£ä¸‹ç”Ÿæˆç”¨æˆ·å…¬é’¥ï¼ˆwindowsä¸‹å®‰è£…msysgitååœ¨git Bashä¸‹ç”Ÿæˆï¼‰ï¼Œå‘½ä»¤ä¸ºï¼šssh-keygenï¼Œç”Ÿæˆååœ¨ç”¨æˆ·ç›®å½•.ssh ä¸‹ï¼Œæ–‡ä»¶åä¸ºid_rsa.pubï¼›</p>
  </li>
  <li>
    <p>å‘é¡¹ç›®ä»“åº“ç®¡ç†å‘˜ç”³è¯·æ“ä½œæŸé¡¹ç›®æƒé™ï¼Œå°†id_rsa.pubæ–‡ä»¶å‘ç»™ç®¡ç†å‘˜ï¼Œå¦‚å¼€å‘å‘˜toméœ€è¦å¼€å‘é¡¹ç›®pangu-la-webï¼Œåˆ™éœ€è¦é‚®ä»¶æˆ–qqç­‰æ–¹å¼å°†id_rsa.pubå‘ç»™ç®¡ç†å‘˜tangszï¼Œå¹¶ç”³æ˜éœ€è¦æœ‰pangu-la-webé¡¹ç›®å¼€å‘æƒé™ï¼›</p>
  </li>
  <li>
    <p>ç®¡ç†å‘˜ä¼šæ ¹æ®tomçš„æƒé™ä¸ºå…¶èµ‹äºˆpangu-la-webé¡¹ç›®ç‰¹å®šæƒé™ï¼ˆå¦‚åªèƒ½æ–°å»ºdevå¼€å¤´çš„åˆ†æ”¯è¿›è¡Œå¼€å‘ï¼Œä¸å…è®¸tomæ“ä½œmasteråˆ†æ”¯ï¼‰ï¼Œç„¶åé€šè¿‡tomå¯ä»¥è¿›è¡Œcloneä»£ç å¼€å‘äº†ï¼›</p>
  </li>
  <li>
    <p>tomæ¥åˆ°é€šçŸ¥åcloneä¸‹pangu-la-webä»£ç åŠå¯ä»¥è¿›è¡Œå¼€å‘äº†ï¼Œcloneå‘½ä»¤ä¸ºï¼šgit clone git@10.20.16.78:pangu-la-web  ï¼ˆwindowsä¸‹åœ¨git Bash çª—å£æ‰§è¡Œï¼‰ï¼›</p>
  </li>
  <li>
    <p>tom cloneå®Œä»£ç åå¯ä»¥è‡ªå·±æ–°å»ºä¸ªåˆ†æ”¯å¦‚dev-tomï¼ˆgit branch dev-tomï¼‰è¿›è¡Œå¼€å‘ï¼Œç„¶ågit checkout dev-tomï¼Œå¾…åŠŸèƒ½å¼€å‘å®Œåpushåˆ°dev-tomåˆ†æ”¯ï¼ˆgit push origin dev-tom)</p>
  </li>
  <li>
    <p>tom åœ¨åˆ†æ”¯dev-tomä¸Šå¼€å‘å®Œåå°±å¯ä»¥é€šçŸ¥ç®¡ç†å‘˜tomçš„åŠŸèƒ½ç‚¹å·²ç»å¼€å‘å®Œäº†ï¼Œç”³è¯·åˆå¹¶åˆ°masteråˆ†æ”¯ï¼›</p>
  </li>
  <li>
    <p>ç®¡ç†å‘˜æ¥åˆ°tomé€šçŸ¥ååšåˆå¹¶å¤„ç†ã€‚</p>
  </li>
</ol>
:ET