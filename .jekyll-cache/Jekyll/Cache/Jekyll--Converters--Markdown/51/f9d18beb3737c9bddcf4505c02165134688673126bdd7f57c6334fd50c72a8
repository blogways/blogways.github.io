I"§<h2 id="ä¸€é»˜è®¤çš„æ§åˆ¶å°è¾“å‡º">ä¸€ã€é»˜è®¤çš„æ§åˆ¶å°è¾“å‡º</h2>
<p>æˆ‘ä»¬ä½¿ç”¨expressæ¡†æ¶æ—¶ï¼Œå¼€å‘æ¨¡å¼ç”¨nodeæˆ–è€…supervisorå¯åŠ¨nodejsåº”ç”¨æ—¶ï¼Œæ§åˆ¶å°éƒ½æ˜¯æ˜¾ç¤ºå¦‚ä¸‹çš„æ—¥å¿—ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /css/bootstrap.min.css 304 1ms
GET /css/my.css 304 0ms
GET /js/bootstrap.min.js 304 4ms
GET /js/jquery-1.9.1.min.js 304 6ms
GET /js/holder.js 304 3ms
GET /cat/json/latest 200 6ms
GET /cat/json/master 200 4ms
GET /cat/json/classic 200 2ms
GET /about 200 6ms
GET /css/bootstrap.min.css 304 2ms
GET /css/my.css 304 2ms
GET /js/bootstrap.min.js 304 2ms
GET /js/jquery-1.9.1.min.js 304 1ms
GET /js/holder.js 304 1ms
GET /js/bootstrap.min.js 304 1ms
GET / 304 6ms
GET /js/jquery-1.9.1.min.js 304 2ms
GET /css/my.css 304 1ms
GET /css/bootstrap.min.css 304 1ms
GET /js/bootstrap.min.js 304 2ms
GET /js/holder.js 304 2ms
GET /cat/json/latest 200 3ms
GET /cat/json/master 200 2ms
GET /cat/json/classic 200 2ms
GET /admin/ 304 13ms
GET /css/bootstrap.min.css 304 3ms
GET /js/jquery-1.9.1.min.js 304 2ms
GET /css/my.css 304 2ms
GET /js/bootstrap.min.js 304 1ms
GET /js/holder.js 304 2ms
</code></pre></div></div>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä»£ç ä¸­ï¼Œç”¨console.log()æ‰“å°ä¸€äº›æ§åˆ¶å°æ—¥å¿—ã€‚</p>

<p>ä¿®æ”¹routes/index.js</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exports.index = function(req, res){
console.log("This is an index page!");
res.render('index', {
  		title:'é¦–é¡µ|moive.me',
  		page:'index'
  		});
};
</code></pre></div></div>

<p>è®¿é—®é¡µé¢ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>This is an index page!
GET / 304 19ms
GET /css/bootstrap.min.css 304 4ms
GET /css/my.css 304 2ms
GET /js/jquery-1.9.1.min.js 304 38ms
GET /js/holder.js 304 29ms
GET /js/bootstrap.min.js 304 28ms
</code></pre></div></div>

<p>è¿™æ ·çš„è¾“å‡ºçš„ç»“æœï¼Œéƒ½æ˜¯åœ¨æ§åˆ¶å°æ˜¾ç¤ºï¼Œä¸€æ—¦serveré‡å¯æ—¥å¿—å°±ä¸¢å¤±äº†ã€‚å¯¹äºç¨‹åºå¼€å‘æ¥è¯´ï¼Œè¿™æ ·çš„è¾“å‡ºå·²ç»å¤Ÿç”¨äº†ã€‚ä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½æŠŠæ§åˆ¶å°çš„è¾“å‡ºï¼Œä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œè€Œä¸”éœ€è¦æ›´å¤šçš„ä¿¡æ¯ï¼Œä¸ä»…ä»…æ˜¯é»˜è®¤çš„ç®€åŒ–çš„æ—¥å¿—ä¿¡æ¯ã€‚</p>

<p>ç”±äºexpressæ¡†æ¶æ²¡æœ‰æ—¥å¿—åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥log4jsåŒ…æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚</p>

<h2 id="äºŒé…ç½®log4jsä¸expressæ¡†æ¶é›†æˆ">äºŒã€é…ç½®log4jsä¸expressæ¡†æ¶é›†æˆ</h2>

<p>1ã€å®‰è£…</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install log4js
</code></pre></div></div>

<p>2ã€ä¿®æ”¹é¡¹ç›®å…¥å£é…ç½®æ–‡ä»¶ï¼Œå¦‚æ—¥å¿—åˆ†æé¡¹ç›®express.js</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var log4js = require('log4js');
log4js.configure({
  appenders: [
    { type: 'console' }, //æ§åˆ¶å°è¾“å‡º
    {
      type: 'file', //æ–‡ä»¶è¾“å‡º
      filename: 'logs/log.log', 
      maxLogSize: 1024,
      backups:3,
      category: 'normal' 
    }
  ]
});
var logger = log4js.getLogger('normal');
logger.setLevel('INFO');
...

app.use(log4js.connectLogger(logger, {level:log4js.levels.INFO}));
app.use(app.router);
</code></pre></div></div>

<p>éœ€è¦åœ¨express.jsä¸­è¿›è¡Œlog4jsçš„é…ç½®ã€‚
appendersä¸­é…ç½®äº†ä¸¤ä¸ªè¾“å‡ºï¼Œä¸€ä¸ªæ˜¯æ§åˆ¶å°è¾“å‡ºï¼Œä¸€ä¸ªæ˜¯æ–‡ä»¶è¾“å‡ºã€‚</p>

<p>appenders.type=fileçš„å¯¹è±¡,æŒ‡å®šæ–‡ä»¶è¾“å‡ºä½ç½®åŠæ–‡ä»¶å¤§å°ï¼Œå½“è¶…è¿‡maxLogSizeå¤§å°æ—¶ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ–°æ–‡ä»¶ã€‚logsçš„æ–‡ä»¶ç›®å½•è¦åŠ¨æ‰‹åˆ›å»ºã€‚
level:log4js.levels.INFO, è®¾ç½®é»˜è®¤æ—¥å¿—è¾“å‡ºçº§åˆ«æ˜¯INFOã€‚</p>

<p>log4jsçš„è¾“å‡ºçº§åˆ«6ä¸ª: trace, debug, info, warn, error, fatal
logger.trace(â€˜Entering cheese testingâ€™);
logger.debug(â€˜Got cheese.â€™);
logger.info(â€˜Cheese is Gouda.â€™);
logger.warn(â€˜Cheese is quite smelly.â€™);
logger.error(â€˜Cheese is too ripe!â€™);
logger.fatal(â€˜Cheese was breeding ground for listeria.â€™);</p>

<p>å¦‚æœè¾“å‡ºçº§åˆ«æ˜¯INFOï¼Œåˆ™ä¸ä¼šæ‰“å°å‡ºä½äºinfoçº§åˆ«çš„æ—¥å¿—trace,debugï¼Œåªæ‰“å°info,warn,error,fatalã€‚è¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æˆ‘ä»¬å¯èƒ½åªå…³å¿ƒå¼‚å¸¸å’Œé”™è¯¯ï¼Œå¹¶ä¸å…³å¿ƒè°ƒè¯•ä¿¡æ¯ã€‚ä»è€Œå¤§å¤§å‡å°‘æ—¥å¿—çš„è¾“å‡ºï¼Œèƒ½å‡å°‘ç£ç›˜å†™å…¥ã€‚è€Œåœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥éœ€è¦æ‰“å°éå¸¸å¤šçš„ä¿¡æ¯ï¼Œå¸®åŠ©å¼€å‘äººå‘˜å®šä½é”™è¯¯ï¼Œè°ƒè¯•ä»£ç ã€‚</p>

<p>è¿˜æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼Œä»£ç ä¸­å¯ä»¥æ··æœ‰å„ç§çš„æ—¥å¿—æ‰“å°ä»£ç ã€‚æˆ‘ä»¬åªè¦åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œä¿®æ”¹è¾“å‡ºçº§åˆ«ï¼Œæ—¥å¿—è¾“å‡ºå°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä¸ç”¨ä¿®æ”¹æ‰€æœ‰çš„ä»£ç ã€‚å¦‚æœæ‰€æœ‰åœ°æ–¹éƒ½æ˜¯console.log()ï¼Œé‚£ä¹ˆä¸Šçº¿çš„æ—¶å€™ï¼Œæ”¹åŠ¨è¿™ä¸ªä¸œè¥¿å°±è¦èŠ±å¾ˆå¤šæ—¶é—´ã€‚</p>

<h2 id="ä¸‰æ ¹æ®é¡¹ç›®é…ç½®log4js">ä¸‰ã€æ ¹æ®é¡¹ç›®é…ç½®log4js</h2>

<ol>
  <li>
    <p>å¢åŠ replaceConsoleä»£æ›¿console.log()</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> var log4js = require('log4js');
 log4js.configure({
   appenders: [
     { type: 'console' },{
       type: 'file', 
       filename: 'logs/log.log', 
       maxLogSize: 1024,
       backups:4,
       category: 'normal' 
     }
   ],
   replaceConsole: true
 });
</code></pre></div>    </div>
  </li>
  <li>
    <p>è°ƒæ•´æ—¥å¿—è¾“å‡ºçš„æ ¼å¼</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> app.use(log4js.connectLogger(logger, {level: 
 level:log4js.levels.INFO, format:':method :url'}));
</code></pre></div>    </div>
  </li>
  <li>
    <p>è‡ªåŠ¨è°ƒæ•´æ—¥å¿—è¾“å‡ºçº§åˆ«</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> æ—¥å¿—çº§åˆ«å¯¹åº”è§„åˆ™ï¼š
 http responses 3xx, level = WARN
 http responses 4xx &amp; 5xx, level = ERROR
 else, level = INFO	 è®¾ç½®levelä¸ºauto:

 app.use(log4js.connectLogger(logger, {level: 'auto', format:':method :url'}));
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="å››è°ƒæ•´log4jsç»“æ„">å››ã€è°ƒæ•´log4jsç»“æ„</h2>

<p>æˆ‘ä»¬åœ¨é…ç½®log4jsæ—¶ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ã€‚å°±æ˜¯ä»¥ä¸Šæ‰€æœ‰é…ç½®ä¿¡æ¯éƒ½æ˜¯åœ¨express.jsä¸­åšçš„ï¼Œloggerä¹Ÿæ˜¯åœ¨è¿™é‡Œç›´æ¥å®šä¹‰çš„ã€‚å¦‚æœåœ¨æ§åˆ¶å™¨(routes)æƒ³ç”¨log4jsè¿›è¡Œè¾“å‡ºï¼Œæˆ‘ä»¬ç°åœ¨æ‹¿ä¸åˆ°loggerçš„å¥æŸ„ã€‚</p>

<p>æ–°å»ºç«‹log.js</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var log4js = require('log4js');

log4js.configure({

    appenders: [
        {
            type: 'console',
            category: "console"

        }, //æ§åˆ¶å°è¾“å‡º
        {
            type: "file",
            filename: 'logs/log.log',
            pattern: "_yyyy-MM-dd",
            maxLogSize: 20480,
            backups: 3,
            category: 'dateFileLog'

        }//æ—¥æœŸæ–‡ä»¶æ ¼å¼
    ],
    replaceConsole: true,   //æ›¿æ¢console.log
    levels:{
        dateFileLog: 'debug',
        console: 'debug'
    }
});


var dateFileLog = log4js.getLogger('dateFileLog');
var consoleLog = log4js.getLogger('console');
exports.logger = consoleLog;


exports.use = function(app) {
    app.use(log4js.connectLogger(consoleLog, {level:'INFO', format:':method :url'}));
}
</code></pre></div></div>

<p>æˆ‘ä»¬æŠŠloggerå•ç‹¬å®šä¹‰å‡ºæ¥ï¼Œå¹¶ä¸”åšä¸ºAPIæš´éœ²å‡ºæ¥ï¼Œæ­¤å¤„æ˜¯å¼€å‘è°ƒè¯•ï¼Œæ²¡æœ‰ä½¿ç”¨æ–‡ä»¶è¾“å‡ºã€‚
è¿™æ ·åœ¨å…¶ä»–æ¨¡å—ä¸­ä½¿ç”¨loggerè¾“å‡ºæ—¥å¿—åªéœ€å¦‚ä¸‹æ“ä½œï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var logger = require('../../log').logger;
logger.debug("collectTime=%s",collectTime);
</code></pre></div></div>

<p>è¿™æ ·æˆ‘ä»¬å°±å·²ç»ç©è½¬log4jsäº†ï¼Œå¦‚æœéƒ¨ç½²ç”Ÿäº§éœ€è¦æ–‡ä»¶è¾“å‡ºåªè¦ä¿®æ”¹log.jsä¸­dateFileLogçº§åˆ«ï¼Œç„¶åè®¾ç½®exports.logger=dateFileLogå³å¯ã€‚</p>
:ET