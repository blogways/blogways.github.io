I"
<p>è¿™å‡ å¤©åœ¨å­¦ä¹ Meteorï¼Œå½“å‰ç‰ˆæœ¬ä¸º:<code class="language-plaintext highlighter-rouge">1.2.1</code>ã€‚å­¦ä¹ çš„ä¸»è¦èµ„æ–™æ¥è‡ªå®˜ç½‘ï¼Œç¬”è®°å¦‚ä¸‹.</p>

<h2 id="ä¸€åˆ›å»ºä¸€ä¸ªåº”ç”¨">ä¸€ã€åˆ›å»ºä¸€ä¸ªåº”ç”¨</h2>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„åº”ç”¨ï¼Œç®¡ç†ä¸€ä¸ªä»»åŠ¡æ¸…å•ã€‚è¿™æ ·å°±å¯ä»¥å’Œå…¶ä»–äººä¸€èµ·ä½¿ç”¨è¿™ä¸ªä»»åŠ¡æ¸…å•ï¼Œè¿›è¡Œåˆä½œäº†ã€‚</p>

<p>ä¸ºäº†åˆ›å»ºè¿™ä¸ªåº”ç”¨ï¼Œéœ€è¦æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥å‘½ä»¤ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meteor create simple-todos
</code></pre></div></div>

<p>è¿™ä¸ªå‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªåä¸º<code class="language-plaintext highlighter-rouge">simple-todos</code>çš„ç›®å½•ï¼Œç›®å½•é‡Œé¢æœ‰Meteoråº”ç”¨æ‰€éœ€è¦çš„ä¸€äº›æ–‡ä»¶ï¼Œåˆ—è¡¨å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>simple-todos.js     #ä¸€ä¸ªè¢«æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½ä½¿ç”¨çš„javascriptæ–‡ä»¶
simple-todos.html   #ä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œé‡Œé¢å®šä¹‰äº†é¡µé¢è§†å›¾æ¨¡ç‰ˆ
simple-todos.css    #ä¸€ä¸ªcssæ–‡ä»¶ï¼Œå®šä¹‰äº†åº”ç”¨çš„å¼æ ·
.meteor             #ä¸€ä¸ªéšè—ç›®å½•ï¼Œé‡Œé¢æœ‰meteorè¿è¡Œéœ€è¦çš„æ–‡ä»¶
</code></pre></div></div>

<p>è¿è¡Œè¿™ä¸ªåº”ç”¨ï¼Œå¯ä»¥è¾“å…¥å‘½ä»¤ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>simple-todos
meteor
</code></pre></div></div>

<p>å¥½äº†ï¼Œæ‰“å¼€ä½ çš„æµè§ˆå™¨ï¼Œç„¶åè¾“å…¥<code class="language-plaintext highlighter-rouge">http://localhost:3000</code>ã€‚</p>

<p>å¦‚æœä½ ä¿®æ”¹äº†simple-todos.htmlï¼Œä½ ä¼šå‘ç°å‡ ç§’åï¼Œæµè§ˆå™¨ä¸Šæ‰“å¼€çš„é¡µé¢å†…å®¹ä¹Ÿä¼šè‡ªåŠ¨å‘ç”Ÿç›¸åº”çš„å˜åŒ–ã€‚è¿™å°±æ˜¯Meteoræ‰€è°“çš„â€œä»£ç çƒ­éƒ¨ç½²â€ã€‚</p>

<h2 id="äºŒä½¿ç”¨æ¨¡ç‰ˆæ¥å®šä¹‰é¡µé¢è§†å›¾">äºŒã€ä½¿ç”¨æ¨¡ç‰ˆæ¥å®šä¹‰é¡µé¢è§†å›¾</h2>

<p>å¥½äº†ï¼Œæˆ‘ä»¬ç»§ç»­åˆ¶ä½œæˆ‘ä»¬çš„ä»»åŠ¡æ¸…å•ç¨‹åºã€‚</p>

<h3 id="21-ä¿®æ”¹ä»£ç ">2.1 ä¿®æ”¹ä»£ç </h3>
<p>æˆ‘ä»¬ç”¨ä¸‹é¢çš„ä»£ç æ›¿ä»£ä¹‹å‰Meteoré»˜è®¤ç”Ÿæˆçš„ä»£ç ã€‚</p>

<p><code class="language-plaintext highlighter-rouge">simple-todos.html</code>çš„ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>Todo List<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
 
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;header&gt;</span>
      <span class="nt">&lt;h1&gt;</span>Todo List<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
 
    <span class="nt">&lt;ul&gt;</span>  
      {{#each tasks}}
        {{&gt; task}}
      {{/each}}
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
 
<span class="nt">&lt;template</span> <span class="na">name=</span><span class="s">"task"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;li&gt;</span>{{text}}<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/template&gt;</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">simple-todos.js</code>çš„ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">Meteor</span><span class="p">.</span><span class="nx">isClient</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// This code only runs on the client</span>
  <span class="nx">Template</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">helpers</span><span class="p">({</span>
    <span class="na">tasks</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="na">text</span><span class="p">:</span> <span class="dl">"</span><span class="s2">This is task 1</span><span class="dl">"</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">text</span><span class="p">:</span> <span class="dl">"</span><span class="s2">This is task 2</span><span class="dl">"</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">text</span><span class="p">:</span> <span class="dl">"</span><span class="s2">This is task 3</span><span class="dl">"</span> <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æ›¿æ¢å®Œä¸Šé¢çš„ä»£ç ï¼Œé™å¾…å‡ ç§’ï¼Œæµè§ˆå™¨ä¸­å±•ç°çš„å†…å®¹å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œç±»ä¼¼å¦‚ä¸‹ï¼š</p>

<blockquote>

  <h1 id="todo-list">Todo List</h1>

  <ul>
    <li>This is task 1</li>
    <li>This is task 2</li>
    <li>This is task 3</li>
  </ul>

</blockquote>

<p>æŒºæœ‰æ„æ€çš„ï¼Œä¸æ˜¯å—ï¼Ÿå¥½å§ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ƒä»¬æ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚</p>

<h3 id="22-meteorä½¿ç”¨htmlæ–‡ä»¶æ¥å®šä¹‰æ¨¡ç‰ˆ">2.2 Meteorä½¿ç”¨HTMLæ–‡ä»¶æ¥å®šä¹‰æ¨¡ç‰ˆ</h3>

<p>Meteorè§£æä½ çš„åº”ç”¨ç›®å½•ä¸‹çš„æ‰€æœ‰HTMLæ–‡ä»¶ã€‚è¯†åˆ«å‡ºä¸‰ä¸ªé¡¶çº§æ ‡ç­¾:<code class="language-plaintext highlighter-rouge">&lt;head&gt;</code>ã€<code class="language-plaintext highlighter-rouge">&lt;body&gt;</code>å’Œ<code class="language-plaintext highlighter-rouge">&lt;template&gt;</code>ã€‚</p>

<p>å…¶ä¸­,<code class="language-plaintext highlighter-rouge">&lt;head&gt;</code>æ ‡ç­¾å’Œ<code class="language-plaintext highlighter-rouge">&lt;body&gt;</code>æ ‡ç­¾é‡Œçš„å†…å®¹éƒ½ä¼šè¢«å‘é€åˆ°å®¢æˆ·ç«¯é¡µé¢ä¸­ï¼Œå¯¹åº”çš„æ ‡ç­¾ä¸‹é¢å»ã€‚</p>

<p>è€Œ<code class="language-plaintext highlighter-rouge">&lt;template&gt;</code>æ ‡ç­¾é‡Œé¢çš„å†…å®¹ï¼Œä¼šè¢«ç¼–è¯‘æˆMeteoræ¨¡ç‰ˆã€‚Meteoræ¨¡ç‰ˆæˆ–è€…è¢«HTMLä¸­çš„<code class="language-plaintext highlighter-rouge">{{&gt;templateName}}</code>å¼•ç”¨ï¼Œæˆ–è€…è¢«JavaScriptç¨‹åºä¸­çš„<code class="language-plaintext highlighter-rouge">Template.templateName</code>æ‰€å¼•ç”¨ã€‚</p>

<h3 id="23-ç»™æ¨¡ç‰ˆæ·»åŠ é€»è¾‘å’Œæ•°æ®">2.3 ç»™æ¨¡ç‰ˆæ·»åŠ é€»è¾‘å’Œæ•°æ®</h3>

<p>Meteorä½¿ç”¨Spacebarsæ¥ç¼–è¯‘HTMLæ–‡ä»¶ä¸­çš„ä»£ç ã€‚Spacebarsç”¨åŒæ‹¬å·å°†è¯­å¥æ‹¬èµ·æ¥ï¼Œæ¯”å¦‚ï¼š<code class="language-plaintext highlighter-rouge">{{#each}}</code>å’Œ<code class="language-plaintext highlighter-rouge">{{#if}}</code>ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼ç»™æ¨¡ç‰ˆæ·»åŠ é€»è¾‘å’Œæ•°æ®ã€‚</p>

<p>æˆ‘ä»¬å¯ä»¥å€Ÿç”¨<code class="language-plaintext highlighter-rouge">helpers</code>ä»JavsScriptä»£ç ä¸­æŠŠæ•°æ®ä¼ ç»™æ¨¡ç‰ˆã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨<code class="language-plaintext highlighter-rouge">Template.body</code>ä¸Šå®šä¹‰äº†ä¸€ä¸ªåä¸º<code class="language-plaintext highlighter-rouge">tasks</code>çš„å¸®åŠ©å™¨(helper)ã€‚å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚åœ¨HTMLçš„bodyæ ‡ç­¾å†…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">{{#each}}</code>æ¥éå†æ•´ä¸ªæ•°ç»„ï¼Œæ’å…¥ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">task</code>æ¨¡ç‰ˆæ¥æ˜¾ç¤ºæ•°ç»„ä¸­çš„æ¯ä¸ªå€¼ã€‚åœ¨<code class="language-plaintext highlighter-rouge">#each</code>è¯­å¥å—å†…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">{{text}}</code>æ¥æ˜¾ç¤ºæ•°ç»„ä¸­æ¯é¡¹çš„<code class="language-plaintext highlighter-rouge">text</code>å±æ€§å€¼ã€‚</p>

<p>å…³äºæ¨¡ç‰ˆçš„æ›´å¤šå†…å®¹ï¼šhttps://github.com/meteor/meteor/blob/devel/packages/spacebars/README.md</p>

<h3 id="24-æ·»åŠ css">2.4 æ·»åŠ CSS</h3>

<p>è¿™ä¸ªåº”ç”¨ä¸æ·»åŠ é¢å¤–çš„csså¼æ ·ï¼Œä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ä¸ºäº†æ›´åŠ ç¾è§‚ï¼Œæˆ‘ä»¬ç»™è¿™ä¸ªåº”ç”¨æ·»åŠ ä¸€äº›CSSå¼æ ·ã€‚</p>

<p><code class="language-plaintext highlighter-rouge">simple-todos.css</code>æ–‡ä»¶å†…å®¹ä¿®æ”¹å¦‚ä¸‹ï¼š</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/* CSS declarations go here */</span>
<span class="nt">body</span> <span class="p">{</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="nb">sans-serif</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#315481</span><span class="p">;</span>
  <span class="nl">background-image</span><span class="p">:</span> <span class="n">linear-gradient</span><span class="p">(</span><span class="n">to</span> <span class="nb">bottom</span><span class="p">,</span> <span class="m">#315481</span><span class="p">,</span> <span class="m">#918e82</span> <span class="m">100%</span><span class="p">);</span>
  <span class="nl">background-attachment</span><span class="p">:</span> <span class="nb">fixed</span><span class="p">;</span>

  <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
  <span class="nl">top</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">bottom</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">right</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>

  <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>

  <span class="nl">font-size</span><span class="p">:</span> <span class="m">14px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.container</span> <span class="p">{</span>
  <span class="nl">max-width</span><span class="p">:</span> <span class="m">600px</span><span class="p">;</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">;</span>
  <span class="nl">min-height</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">background</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">header</span> <span class="p">{</span>
  <span class="nl">background</span><span class="p">:</span> <span class="m">#d2edf4</span><span class="p">;</span>
  <span class="nl">background-image</span><span class="p">:</span> <span class="n">linear-gradient</span><span class="p">(</span><span class="n">to</span> <span class="nb">bottom</span><span class="p">,</span> <span class="m">#d0edf5</span><span class="p">,</span> <span class="m">#e1e5f0</span> <span class="m">100%</span><span class="p">);</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">20px</span> <span class="m">15px</span> <span class="m">15px</span> <span class="m">15px</span><span class="p">;</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">#login-buttons</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h1</span> <span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">1.5em</span><span class="p">;</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">margin-bottom</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">inline-block</span><span class="p">;</span>
  <span class="nl">margin-right</span><span class="p">:</span> <span class="m">1em</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">form</span> <span class="p">{</span>
  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
  <span class="nl">margin-bottom</span><span class="p">:</span> <span class="m">-10px</span><span class="p">;</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.new-task</span> <span class="nt">input</span> <span class="p">{</span>
  <span class="nl">box-sizing</span><span class="p">:</span> <span class="n">border-box</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">10px</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">background</span><span class="p">:</span> <span class="nb">transparent</span><span class="p">;</span>
  <span class="nl">border</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">padding-right</span><span class="p">:</span> <span class="m">80px</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">1em</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.new-task</span> <span class="nt">input</span><span class="nd">:focus</span><span class="p">{</span>
  <span class="nl">outline</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">ul</span> <span class="p">{</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">background</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.delete</span> <span class="p">{</span>
  <span class="nl">float</span><span class="p">:</span> <span class="nb">right</span><span class="p">;</span>
  <span class="nl">font-weight</span><span class="p">:</span> <span class="nb">bold</span><span class="p">;</span>
  <span class="nl">background</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">1em</span><span class="p">;</span>
  <span class="nl">border</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">li</span> <span class="p">{</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
  <span class="nl">list-style</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">15px</span><span class="p">;</span>
  <span class="nl">border-bottom</span><span class="p">:</span> <span class="m">#eee</span> <span class="nb">solid</span> <span class="m">1px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">li</span> <span class="nc">.text</span> <span class="p">{</span>
  <span class="nl">margin-left</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">li</span><span class="nc">.checked</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#888</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">li</span><span class="nc">.checked</span> <span class="nc">.text</span> <span class="p">{</span>
  <span class="nl">text-decoration</span><span class="p">:</span> <span class="nb">line-through</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">li</span><span class="nc">.private</span> <span class="p">{</span>
  <span class="nl">background</span><span class="p">:</span> <span class="m">#eee</span><span class="p">;</span>
  <span class="nl">border-color</span><span class="p">:</span> <span class="m">#ddd</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">header</span> <span class="nc">.hide-completed</span> <span class="p">{</span>
  <span class="nl">float</span><span class="p">:</span> <span class="nb">right</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.toggle-private</span> <span class="p">{</span>
  <span class="nl">margin-left</span><span class="p">:</span> <span class="m">5px</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@media</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">600px</span><span class="p">)</span> <span class="p">{</span>
  <span class="nt">li</span> <span class="p">{</span>
    <span class="nl">padding</span><span class="p">:</span> <span class="m">12px</span> <span class="m">15px</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nc">.search</span> <span class="p">{</span>
    <span class="nl">width</span><span class="p">:</span> <span class="m">150px</span><span class="p">;</span>
    <span class="nl">clear</span><span class="p">:</span> <span class="nb">both</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nc">.new-task</span> <span class="nt">input</span> <span class="p">{</span>
    <span class="nl">padding-bottom</span><span class="p">:</span> <span class="m">5px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="ä¸‰ä½¿ç”¨é›†åˆæ¥å­˜å‚¨æ•°æ®">ä¸‰ã€ä½¿ç”¨é›†åˆæ¥å­˜å‚¨æ•°æ®</h2>

<p>é›†åˆæ˜¯Meteorç”¨æ¥å­˜å‚¨æŒä¹…åŒ–æ•°æ®çš„æ–¹æ³•ã€‚å…¶ç‰¹æ®Šä¹‹å¤„åœ¨äºï¼Œå®ƒæ—¢å¯è¢«æœåŠ¡ç«¯è®¿é—®ï¼Œä¹Ÿå¯è¢«å®¢æˆ·ç«¯è®¿é—®ã€‚è¿™æ ·å°±å¾ˆå®¹æ˜“åšåˆ°ï¼Œæ— éœ€ç¼–å†™å¤§é‡æœåŠ¡ç«¯ä»£ç å°±å¯ä»¥å®ç°é¡µé¢é€»è¾‘ã€‚ä»–ä»¬ä¹Ÿå¯ä»¥è‡ªåŠ¨æ›´æ–°ï¼Œæ‰€ä»¥ç”±é›†åˆæ”¯æŒçš„é¡µé¢è§†å›¾ç»„ä»¶å¯ä»¥è‡ªåŠ¨æ˜¾ç¤ºæœ€æ–°æ•°æ®ã€‚</p>

<p>åœ¨ä½ çš„JavaScriptä»£ç é‡Œï¼Œé€šè¿‡è°ƒç”¨<code class="language-plaintext highlighter-rouge">MyCollection = new Mongo.Collection("my-collection");</code>ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ›å»ºä¸€ä¸ªæ–°çš„é›†åˆã€‚åœ¨æœåŠ¡å™¨ç«¯ï¼Œè¿™è¡Œä»£ç ä¼šè®¾ç½®ä¸€ä¸ªåä¸º<code class="language-plaintext highlighter-rouge">my-collection</code>çš„MongoDBé›†åˆï¼›åœ¨å®¢æˆ·ç«¯ï¼Œè¿™è¡Œä»£ç ä¼šåˆ›å»ºä¸€ä¸ªç¼“å­˜ï¼Œè¿™ä¸ªç¼“å­˜å’ŒæœåŠ¡å™¨ç«¯é›†åˆå­˜åœ¨è¿æ¥ã€‚åé¢ï¼Œæˆ‘ä»¬ä¼šäº†è§£çš„æ›´å¤šè¯¦æƒ…ï¼Œç°åœ¨å°±è®©æˆ‘ä»¬å‡è®¾æ•´ä¸ªæ•°æ®åº“éƒ½å­˜åœ¨äºå®¢æˆ·ç«¯ã€‚</p>

<p>ä¸‹é¢æˆ‘ä»¬ä¿®æ”¹JavaScriptä»£ç ï¼Œä»æ•°æ®åº“é›†åˆä¸­è·å–ä»»åŠ¡ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Tasks</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mongo</span><span class="p">.</span><span class="nx">Collection</span><span class="p">(</span><span class="dl">"</span><span class="s2">tasks</span><span class="dl">"</span><span class="p">);</span>
 
<span class="k">if</span> <span class="p">(</span><span class="nx">Meteor</span><span class="p">.</span><span class="nx">isClient</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// This code only runs on the client</span>
  <span class="nx">Template</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">helpers</span><span class="p">({</span>
    <span class="na">tasks</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">({});</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ä½¿ç”¨ä¸Šé¢ä»£ç åï¼Œé™å¾…å‡ ç§’é’Ÿï¼Œç­‰å¾…Meteorâ€œçƒ­éƒ¨ç½²â€å®Œæˆã€‚æˆ‘ä»¬ä¼šå‘ç°ä»»åŠ¡åˆ—è¡¨ä¸­çš„è®°å½•æ¶ˆå¤±äº†ï¼Œè¿™æ˜¯å› ä¸ºæ•°æ®åº“é›†åˆæ˜¯ç©ºçš„ã€‚æˆ‘ä»¬éœ€è¦å‘æ•°æ®åº“é›†åˆä¸­æ’å…¥ä¸€äº›ä»»åŠ¡æ•°æ®ã€‚</p>

<h3 id="ä»æœåŠ¡å™¨ç«¯æ•°æ®åº“æ§åˆ¶å°æ’å…¥ä»»åŠ¡æ•°æ®">ä»æœåŠ¡å™¨ç«¯æ•°æ®åº“æ§åˆ¶å°æ’å…¥ä»»åŠ¡æ•°æ®</h3>

<p>æ•°æ®åº“é›†åˆé‡Œçš„æ•°æ®è¢«ç§°ä¸ºæ–‡æ¡£ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨æ•°æ®åº“çš„æ§åˆ¶å°æ’å…¥ä¸€äº›æ–‡æ¡£åˆ°ä»»åŠ¡é›†åˆä¸­å»ã€‚</p>

<p>æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯é¡µï¼Œè¿›å…¥åº”ç”¨æ‰€åœ¨ç›®å½•ï¼Œç„¶åè¾“å…¥å‘½ä»¤:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meteor mongo
</code></pre></div></div>
<p>å½“å‰æ§åˆ¶å°ä¼šè¿ä¸Šåº”ç”¨çš„æœ¬åœ°å¼€å‘æ•°æ®åº“ï¼Œåœ¨æ•°æ®åº“çš„äº¤äº’æ¨¡å¼ä¸‹ï¼Œè¾“å…¥å‘½ä»¤ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span> <span class="na">text</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Hello world!</span><span class="dl">"</span><span class="p">,</span> <span class="na">createdAt</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="p">});</span>
</code></pre></div></div>

<p>å†çœ‹çœ‹æµè§ˆå™¨ï¼Œä½ å°†å‘ç°åº”ç”¨ç•Œé¢ç«‹åˆ»æ˜¾ç¤ºå‡ºäº†æ–°ä»»åŠ¡è®°å½•ã€‚ä½ ä¼šå‘ç°æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å¹¶æ²¡æœ‰å†™ä»€ä¹ˆè¿æ¥ä»£ç ï¼Œä½†æ˜¯æ•°æ®æ°æ°è‡ªåŠ¨æ›´æ–°äº†ã€‚</p>

<p>åœ¨æ•°æ®åº“æ§åˆ¶å°ä¸Šï¼Œç”¨ç›¸åŒçš„æ–¹æ³•ï¼Œå†æ’å…¥ä¸€äº›ä¸åŒå†…å®¹çš„ä»»åŠ¡è®°å½•ã€‚</p>

<p>ä¸‹é¢ï¼Œæˆ‘ä»¬çœ‹çœ‹æ€ä¹ˆç»™åº”ç”¨é¡µé¢å¢åŠ åŠŸèƒ½ï¼Œä¸é€šè¿‡åç«¯æ•°æ®åº“æ§åˆ¶å°ï¼Œç›´æ¥é€šè¿‡å‰ç«¯é¡µé¢å¢åŠ ä»»åŠ¡è®°å½•ã€‚</p>

<h2 id="å››é€šè¿‡é¡µé¢æ·»åŠ ä»»åŠ¡">å››ã€é€šè¿‡é¡µé¢æ·»åŠ ä»»åŠ¡</h2>

<p>åœ¨è¿™ä¸€ç¯èŠ‚ï¼Œæˆ‘ä»¬è¦æä¾›ä¸€ä¸ªè¾“å…¥æ¡†ç»™ç”¨æˆ·ï¼Œä»¥ä¾¿å‘ä»»åŠ¡æ¸…å•ä¸­æ·»åŠ ä»»åŠ¡è®°å½•ã€‚</p>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨HTMLé‡Œæ·»åŠ ä¸€ä¸ªformã€‚å®Œæ•´çš„simple-todos.htmlå¦‚ä¸‹ï¼š</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>Todo List<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
 
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;header&gt;</span>
      <span class="nt">&lt;h1&gt;</span>Todo List<span class="nt">&lt;/h1&gt;</span>

      <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"new-task"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"Type to add new tasks"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
 
    <span class="nt">&lt;ul&gt;</span>
      {{#each tasks}}
        {{&gt; task}}
      {{/each}}
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
 
<span class="nt">&lt;template</span> <span class="na">name=</span><span class="s">"task"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;li&gt;</span>{{text}}<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/template&gt;</span>
</code></pre></div></div>

<p>åœ¨Javascriptä»£ç ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ å¯¹é¡µé¢formçš„<code class="language-plaintext highlighter-rouge">submit</code>äº‹ä»¶çš„ç›‘å¬æ–¹æ³•ã€‚å®Œæ•´çš„simple-todos.jsæ–‡ä»¶å¦‚ä¸‹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Tasks</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mongo</span><span class="p">.</span><span class="nx">Collection</span><span class="p">(</span><span class="dl">"</span><span class="s2">tasks</span><span class="dl">"</span><span class="p">);</span>
 
<span class="k">if</span> <span class="p">(</span><span class="nx">Meteor</span><span class="p">.</span><span class="nx">isClient</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// This code only runs on the client</span>
  <span class="nx">Template</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">helpers</span><span class="p">({</span>
    <span class="na">tasks</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">({});</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">Template</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">events</span><span class="p">({</span>
    <span class="dl">"</span><span class="s2">submit .new-task</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Prevent default browser form submit</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
 
      <span class="c1">// Get value from form element</span>
      <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
 
      <span class="c1">// Insert a task into the collection</span>
      <span class="nx">Tasks</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span>
        <span class="na">text</span><span class="p">:</span> <span class="nx">text</span><span class="p">,</span>
        <span class="na">createdAt</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="c1">// current time</span>
      <span class="p">});</span>
 
      <span class="c1">// Clear form</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ç°åœ¨åº”ç”¨æœ‰äº†ä¸€ä¸ªæ–°çš„è¾“å…¥æ¡†ã€‚è¦æ·»åŠ ä»»åŠ¡è®°å½•ï¼Œåªéœ€è¦åœ¨è¾“å…¥æ¡†è¾“å…¥å†…å®¹ï¼Œç„¶åç‚¹å‡»å›è½¦å°±å¥½äº†ã€‚å¦‚æœä½ å¦å¤–æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨çª—å£ï¼Œå¹¶æ–°çª—å£ä¸­æ‰“å¼€åº”ç”¨ï¼Œä½ ä¼šå‘ç°å¤šä¸ªå®¢æˆ·ç«¯ä¸Šçš„ä»»åŠ¡è®°å½•æ˜¯è‡ªåŠ¨åŒæ­¥çš„ï¼</p>

<p>###ç»™æ¨¡ç‰ˆç»‘å®šäº‹ä»¶</p>

<p>ç»™æ¨¡ç‰ˆæ·»åŠ äº‹ä»¶çš„æ–¹å¼å¦‚åŒhelpersæ–¹æ³•çš„ä½¿ç”¨ï¼šè°ƒç”¨<code class="language-plaintext highlighter-rouge">Template.templateName.events(...)</code>ï¼Œä¼ å…¥ä¸€ä¸ªkey-valueå­—å…¸ç±»å‹å‚æ•°ã€‚å…¶ä¸­keyæè¿°ç›‘å¬çš„äº‹ä»¶ï¼Œå…¶ä¸­valueæ˜¯äº‹ä»¶å¥æŸ„æ–¹æ³•ã€‚</p>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç›‘å¬CSSé€‰æ‹©å™¨<code class="language-plaintext highlighter-rouge">.new-task</code>åŒ¹é…çš„ä»»æ„å…ƒç´ çš„<code class="language-plaintext highlighter-rouge">submit</code>äº‹ä»¶ã€‚å½“ç”¨æˆ·åœ¨è¾“å…¥æ¡†å†…æŒ‰ä¸‹å›è½¦é”®æ—¶ï¼Œå°†ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ï¼Œæˆ‘ä»¬è®¾ç½®çš„äº‹ä»¶æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ã€‚</p>

<p>è¢«è°ƒç”¨çš„äº‹ä»¶æ–¹æ³•æœ‰ä¸€ä¸ªè¾“å…¥å‚æ•°<code class="language-plaintext highlighter-rouge">event</code>ï¼Œè¿™ä¸ªå‚æ•°åŒ…å«äº†è¢«è§¦å‘çš„äº‹ä»¶çš„ä¸€äº›ä¿¡æ¯ã€‚åœ¨è¿™é‡Œï¼Œ<code class="language-plaintext highlighter-rouge">event.target</code>æ˜¯æˆ‘ä»¬è¿™ä¸ªé¡µé¢ä¸Šçš„formå…ƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code class="language-plaintext highlighter-rouge">event.target.text.value</code>æ¥è·å–è¾“å…¥æ¡†ä¸­çš„è¾“å…¥å€¼ã€‚ä½ å¯ä»¥åœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ï¼Œé€šè¿‡<code class="language-plaintext highlighter-rouge">console.log(event)</code>æ¥æŸ¥çœ‹<code class="language-plaintext highlighter-rouge">event</code>çš„å„ä¸ªå±æ€§ã€‚</p>

<p>æœ€å¥½ï¼Œåœ¨è¿™ä¸ªäº‹ä»¶æ–¹æ³•çš„æœ€åä¸€è¡Œï¼Œæˆ‘ä»¬æ¸…é™¤äº†è¾“å…¥æ¡†ä¸­çš„å†…å®¹ï¼Œå‡†å¤‡ä¸‹ä¸€æ¬¡è¾“å…¥ã€‚</p>

<p>###å‘é›†åˆä¸­æ’å…¥æ•°æ®</p>

<p>åœ¨è¿™ä¸ªäº‹ä»¶æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨<code class="language-plaintext highlighter-rouge">Tasks.insert()</code>æ¥å‘<code class="language-plaintext highlighter-rouge">tasks</code>é›†åˆä¸­æ·»åŠ ä¸€æ¡ä»»åŠ¡è®°å½•ã€‚æˆ‘ä»¬ä¸éœ€è¦äº‹å…ˆå®šä¹‰é›†åˆçš„ç»“æ„ï¼Œå°±å¯ä»¥å‘é›†åˆä¸­çš„è®°å½•æ·»åŠ å„ç§å±æ€§å­—æ®µï¼Œæ¯”å¦‚ï¼šè¢«åˆ›å»ºçš„æ—¶é—´ã€‚</p>

<p>###æ’åºæŸ¥è¯¢ç»“æœ</p>

<p>ç°åœ¨ï¼Œæ‰€æœ‰æ–°çš„ä»»åŠ¡è®°å½•éƒ½æ˜¾ç¤ºåœ¨é¡µé¢çš„åº•éƒ¨ã€‚è¿™ç§ä½“éªŒä¸æ˜¯å¤ªå¥½ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›å…ˆçœ‹åˆ°æœ€æ–°çš„ä»»åŠ¡ã€‚</p>

<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code class="language-plaintext highlighter-rouge">createdAt</code>å­—æ®µæ¥æ’åºæŸ¥è¯¢ç»“æœã€‚æ‰€éœ€åšçš„ï¼Œä»…æ˜¯ç»™<code class="language-plaintext highlighter-rouge">find</code>æ–¹æ³•æ·»åŠ ä¸€ä¸ªæ’åºé€‰é¡¹ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">// This code only runs on the client</span>
  <span class="nx">Template</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">helpers</span><span class="p">({</span>
    <span class="na">tasks</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="c1">// Show newest tasks at the top</span>
      <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="p">{</span><span class="na">sort</span><span class="p">:</span> <span class="p">{</span><span class="na">createdAt</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}});</span>
    <span class="p">}</span>
  <span class="p">});</span>
</code></pre></div></div>

<h2 id="äº”å·²å¤„ç†ä¸åˆ é™¤ä»»åŠ¡">äº”ã€å·²å¤„ç†ä¸åˆ é™¤ä»»åŠ¡</h2>

<p>å‰é¢ï¼Œæˆ‘ä»¬å­¦ä¹ äº†æ€ä¹ˆå‘é›†åˆä¸­æ’å…¥æ•°æ®ï¼Œä¸‹é¢å­¦ä¹ å¦‚ä½•æ›´æ–°åŠåˆ é™¤æ•°æ®ã€‚</p>

<p>æˆ‘ä»¬å…ˆç»™<code class="language-plaintext highlighter-rouge">task</code>æ¨¡ç‰ˆå¢åŠ ä¸¤ä¸ªé¡µé¢å…ƒç´ ï¼šä¸€ä¸ªå¤é€‰æ¡†å’Œä¸€ä¸ªåˆ é™¤æŒ‰é’®ã€‚</p>

<p>æ›¿æ¢simple-todos.htmlæ–‡ä»¶ä¸­çš„<code class="language-plaintext highlighter-rouge">task</code>æ¨¡ç‰ˆï¼Œå†…å®¹å¦‚ä¸‹:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;template</span> <span class="na">name=</span><span class="s">"task"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"{{#if checked}}checked{{/if}}"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"delete"</span><span class="nt">&gt;</span><span class="ni">&amp;times;</span><span class="nt">&lt;/button&gt;</span>
 
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">checked=</span><span class="s">"{{checked}}"</span> <span class="na">class=</span><span class="s">"toggle-checked"</span> <span class="nt">/&gt;</span>
 
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"text"</span><span class="nt">&gt;</span>{{text}}<span class="nt">&lt;/span&gt;</span>
  <span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/template&gt;</span>
</code></pre></div></div>

<p>ä»…æ·»åŠ UIå…ƒç´ ï¼Œé¡µé¢å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ˜¯æ–°å…ƒç´ ä¸èƒ½ä½¿ç”¨ã€‚æˆ‘ä»¬éœ€è¦æ·»åŠ ç›¸åº”çš„äº‹ä»¶ã€‚</p>

<p>ä¿®æ”¹simple-todos.jsæ–‡ä»¶ï¼Œå¢åŠ ç›¸å…³äº‹ä»¶ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Template</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">events</span><span class="p">({</span>
    <span class="dl">"</span><span class="s2">click .toggle-checked</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="c1">// Set the checked property to the opposite of its current value</span>
      <span class="nx">Tasks</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">$set</span><span class="p">:</span> <span class="p">{</span><span class="na">checked</span><span class="p">:</span> <span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">checked</span><span class="p">}</span>
      <span class="p">});</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">click .delete</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">Tasks</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>å¥½äº†ï¼Œé™å¾…Meteorâ€œçƒ­éƒ¨ç½²â€åï¼Œç‚¹å‡»é¡µé¢ä¸Šçš„å¤é€‰æ¡†æˆ–è€…åˆ é™¤æŒ‰é’®ã€‚çœ‹çœ‹æ•ˆæœå§ï¼</p>

<h3 id="åœ¨äº‹ä»¶æ–¹æ³•ä¸­è·å–æ•°æ®">åœ¨äº‹ä»¶æ–¹æ³•ä¸­è·å–æ•°æ®</h3>

<p>åœ¨äº‹ä»¶æ–¹æ³•ä¸­ï¼Œ<code class="language-plaintext highlighter-rouge">this</code>æŒ‡å‘å½“å‰è¿™ä¸ªä»»åŠ¡å¯¹è±¡ã€‚åœ¨æ•°æ®åº“é›†åˆä¸­ï¼Œæ¯ä¸ªæ’å…¥çš„æ–‡æ¡£éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€å€¼<code class="language-plaintext highlighter-rouge">_id</code>å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå­—æ®µæ‰¾åˆ°æ¯ä¸ªæ–‡æ¡£ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">this.id</code>æ¥è·å–å½“å‰ä»»åŠ¡è®°å½•çš„<code class="language-plaintext highlighter-rouge">_id</code>å­—æ®µã€‚ä¸€æ—¦æœ‰äº†<code class="language-plaintext highlighter-rouge">_id</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">update</code>æˆ–è€…<code class="language-plaintext highlighter-rouge">remove</code>æ–¹æ³•æ¥ä¿®æ”¹å¯¹åº”çš„ä»»åŠ¡è®°å½•äº†ã€‚</p>

<h3 id="æ›´æ–°">æ›´æ–°</h3>

<p>é›†åˆçš„<code class="language-plaintext highlighter-rouge">update</code>æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯é€‰æ‹©å™¨ï¼Œå¯ä»¥ç­›é€‰å‡ºé›†åˆçš„å­é›†ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸ªæ›´æ–°å‚æ•°ï¼Œåˆ—å‡ºåŒ¹é…çš„ç»“æœéƒ½åšå¦‚ä½•ä¿®æ”¹ã€‚</p>

<p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€‰æ‹©å™¨å°±æ˜¯ä»»åŠ¡çš„<code class="language-plaintext highlighter-rouge">_id</code>å­—æ®µå€¼ï¼›æ›´æ–°å‚æ•°ä½¿ç”¨<code class="language-plaintext highlighter-rouge">$set</code>å»åˆ‡æ¢<code class="language-plaintext highlighter-rouge">checked</code>å­—æ®µçš„å€¼ï¼Œæ¥ä»£è¡¨å½“å‰ä»»åŠ¡è®°å½•æ˜¯å¦å¤„ç†å®Œæˆã€‚</p>

<h3 id="åˆ é™¤">åˆ é™¤</h3>

<p>é›†åˆçš„<code class="language-plaintext highlighter-rouge">remove</code>æ–¹æ³•åªæœ‰ä¸€ä¸ªå‚æ•°â€”â€”é€‰æ‹©å™¨ï¼Œå®ƒå†³å®šäº†é›†åˆä¸­çš„å“ªé¡¹è®°å½•è¢«åˆ é™¤ã€‚</p>

<p>###ä½¿ç”¨å¯¹è±¡çš„å±æ€§(æˆ–è€…ä½¿ç”¨helpers)å»æ·»åŠ /åˆ é™¤é¡µé¢å¼æ ·</p>

<p>ä½ å¦‚æœæ ‡è®°æŸäº›ä»»åŠ¡å·²ç»å®Œæˆï¼Œä½ ä¼šå‘ç°è¢«æ ‡è®°å¤„ç†å®Œæˆçš„ä»»åŠ¡éƒ½æœ‰ä¸€æ¡åˆ é™¤çº¿ã€‚è¿™ä¸ªæ•ˆæœç”±ä¸‹é¢ä»£ç å®ç°ï¼š</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"{{#if checked}}checked{{/if}}"</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p>å¦‚æœä»»åŠ¡çš„<code class="language-plaintext highlighter-rouge">checked</code>å±æ€§ä¸º<code class="language-plaintext highlighter-rouge">true</code>ï¼Œé‚£ä¹ˆ<code class="language-plaintext highlighter-rouge">checked</code>å¼æ ·ç±»ï¼Œå°±è¦åŠ åˆ°è¿™ä¸ª<code class="language-plaintext highlighter-rouge">li</code>å…ƒç´ ä¸Šã€‚ä½¿ç”¨è¿™ä¸ªç±»ï¼Œæˆ‘ä»¬å¯ä»¥è®©å®Œæˆå¤„ç†çš„ä»»åŠ¡é¡¹å¾ˆå®¹æ˜“è¯†åˆ«å‡ºæ¥ã€‚</p>

<h2 id="å…­å‘å¸ƒåº”ç”¨">å…­ã€å‘å¸ƒåº”ç”¨</h2>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªå¯ä»¥å·¥ä½œçš„ä»»åŠ¡æ¸…å•åº”ç”¨äº†ã€‚æˆ‘ä»¬å¯ä»¥æŠŠä»–åˆ†äº«ç»™æœ‹å‹ä»¬ã€‚Meteorå¾ˆå®¹æ˜“åœ°æ”¯æŒæŠŠåº”ç”¨å‘å¸ƒåˆ°ç½‘ç»œä¸Šï¼Œè®©ç½‘ç»œä¸Šçš„å…¶ä»–äººä½¿ç”¨ã€‚</p>

<p>è¿›å…¥ä½ çš„åº”ç”¨æ‰€åœ¨ç›®å½•ï¼Œè¾“å…¥ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meteor deploy my_app_name.meteor.com
</code></pre></div></div>

<p>ä¸€æ—¦ä½ å›ç­”å®Œæ‰€æœ‰äº¤äº’é—®é¢˜ï¼Œå¹¶ä¸Šä¼ æˆåŠŸã€‚ä½ å°±å¯ä»¥é€šè¿‡è®¿é—®<code class="language-plaintext highlighter-rouge">http://my_app_name.meteor.com</code>ï¼Œæ¥åœ¨äº’è”ç½‘ä¸Šä½¿ç”¨ä½ çš„åº”ç”¨äº†ã€‚</p>

<h2 id="ä¸ƒåœ¨androidæˆ–iosä¸Šè¿è¡Œä½ çš„åº”ç”¨">ä¸ƒã€åœ¨Androidæˆ–iOSä¸Šè¿è¡Œä½ çš„åº”ç”¨</h2>

<blockquote>
  <p>ç›®å‰ï¼ŒMeteorä¸æ”¯æŒåœ¨Windowsä¸Šåˆ›å»ºç§»åŠ¨ç«¯åº”ç”¨ã€‚å¦‚æœï¼Œä½ æ˜¯åœ¨Windowsä¸Šä½¿ç”¨Meteorï¼Œè¯·è·³è¿‡æœ¬èŠ‚ã€‚</p>

</blockquote>

<p>æ­¤å¤„çœå»è‹¥å¹²å†…å®¹ï¼Œæœ‰å¾…æ—¥åå¦èµ·ç¯‡ç« è®°å½•ã€‚</p>

<h2 id="å…«ä½¿ç”¨sessionå˜é‡å»å­˜å‚¨ä¸´æ—¶çš„uiçŠ¶æ€">å…«ã€ä½¿ç”¨Sessionå˜é‡å»å­˜å‚¨ä¸´æ—¶çš„UIçŠ¶æ€</h2>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¦ç»™åº”ç”¨å¢åŠ ä¸€ä¸ªå®¢æˆ·ç«¯ç­›é€‰åŠŸèƒ½ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥ç‚¹å‡»ä¸€ä¸ªå¤é€‰æ¡†å»æŸ¥çœ‹å¾…å¤„ç†çš„ä»»åŠ¡ã€‚æˆ‘ä»¬å­¦ç€åœ¨å®¢æˆ·ç«¯ä½¿ç”¨<code class="language-plaintext highlighter-rouge">Session</code>å˜é‡å»å­˜å‚¨ä¸´æ—¶å˜åŒ–çš„çŠ¶æ€ã€‚</p>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡µé¢æ¨¡ç‰ˆä¸­å¢åŠ ä¸€ä¸ªå¤é€‰æ¡†ï¼Œsimple-todos.htmlé¡µé¢ä¸­<code class="language-plaintext highlighter-rouge">body</code>æ¨¡ç‰ˆçš„ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;header&gt;</span>
      <span class="nt">&lt;h1&gt;</span>Todo List<span class="nt">&lt;/h1&gt;</span>

      <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"hide-completed"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">checked=</span><span class="s">"{{hideCompleted}}"</span> <span class="nt">/&gt;</span>
        Hide Completed Tasks
      <span class="nt">&lt;/label&gt;</span>

      <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"new-task"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"Type to add new tasks"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
 
    <span class="nt">&lt;ul&gt;</span>
      {{#each tasks}}
        {{&gt; task}}
      {{/each}}
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div>

<p>æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªäº‹ä»¶å¤„ç†æ–¹æ³•ï¼Œåœ¨å¤é€‰æ¡†çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå»æ›´æ–°<code class="language-plaintext highlighter-rouge">Session</code>å˜é‡ã€‚<code class="language-plaintext highlighter-rouge">Session</code>æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„å¯ä»¥å­˜æ”¾ä¸´æ—¶UIçŠ¶æ€çš„åœ°æ–¹ã€‚å¦‚åŒé›†åˆä¸€æ ·ï¼Œå¯ä»¥åœ¨helpersæ–¹æ³•ä¸­è¢«è°ƒç”¨ã€‚</p>

<p>ä¿®æ”¹simple-todos.jsæ–‡ä»¶ä¸­çš„<code class="language-plaintext highlighter-rouge">Template.body.events(...)</code>ï¼Œä¿®æ”¹åå†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Template</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">events</span><span class="p">({</span>
    <span class="dl">"</span><span class="s2">submit .new-task</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Prevent default browser form submit</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
 
      <span class="c1">// Get value from form element</span>
      <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
 
      <span class="c1">// Insert a task into the collection</span>
      <span class="nx">Tasks</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span>
        <span class="na">text</span><span class="p">:</span> <span class="nx">text</span><span class="p">,</span>
        <span class="na">createdAt</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="c1">// current time</span>
      <span class="p">});</span>
 
      <span class="c1">// Clear form</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="dl">"</span><span class="s2">change .hide-completed input</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">Session</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">hideCompleted</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">checked</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹<code class="language-plaintext highlighter-rouge">Template.body.helpers</code>ã€‚ä¸‹é¢è¿™æ®µä»£ç å¢åŠ äº†ä¸€ä¸ªæ–°çš„<code class="language-plaintext highlighter-rouge">if</code>è¯­å¥å—ï¼Œå»å®ç°å½“å¤é€‰æ¡†è¢«é€‰ä¸­æ—¶å¯¹ä»»åŠ¡æ¸…å•çš„è¿‡æ»¤ï¼›å¢åŠ äº†ä¸€ä¸ªæ–°çš„æ–¹æ³•ï¼Œå»è·å–Sessionå˜é‡ä¸­è®°å½•çš„å¤é€‰æ¡†çŠ¶æ€ã€‚</p>

<p>ä¿®æ”¹simple-todos.jsæ–‡ä»¶ä¸­çš„<code class="language-plaintext highlighter-rouge">Template.body.helpers(...)</code>ï¼Œä¿®æ”¹ä¸ºï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Template</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">helpers</span><span class="p">({</span>
    <span class="na">tasks</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">Session</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">hideCompleted</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// If hide completed is checked, filter tasks</span>
        <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="na">checked</span><span class="p">:</span> <span class="p">{</span><span class="na">$ne</span><span class="p">:</span> <span class="kc">true</span><span class="p">}},</span> <span class="p">{</span><span class="na">sort</span><span class="p">:</span> <span class="p">{</span><span class="na">createdAt</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Otherwise, return all of the tasks</span>
        <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="p">{</span><span class="na">sort</span><span class="p">:</span> <span class="p">{</span><span class="na">createdAt</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}});</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="na">hideCompleted</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Session</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">hideCompleted</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>ç°åœ¨å¦‚æœä½ é€‰ä¸­å¤é€‰æ¡†ï¼Œé‚£ä¹ˆä»»åŠ¡æ¸…å•ä¸­åªæ˜¾ç¤ºæ²¡æœ‰å®Œæˆçš„ä»»åŠ¡äº†ï¼</p>

<h3 id="sessionæ˜¯å®¢æˆ·ç«¯çš„ä¸€ä¸ªå“åº”å¼æ•°æ®å­˜å‚¨">Sessionæ˜¯å®¢æˆ·ç«¯çš„ä¸€ä¸ªå“åº”å¼æ•°æ®å­˜å‚¨</h3>

<p>æˆªæ­¢ç›®å‰ï¼Œæˆ‘ä»¬å·²ç»æŠŠæ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åˆ°é›†åˆä¸­å»äº†ï¼Œå½“æ•°æ®åº“é›†åˆä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œå‰ç«¯é¡µé¢ä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°ã€‚è¿™æ˜¯å› ä¸ºMongoçš„é›†åˆæ˜¯Meteorå…¬è®¤çš„å“åº”å¼æ•°æ®æºï¼Œè¿™æ„å‘³ç€ï¼Œä¸€æ—¦å…¶ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼ŒMeteorå°±çŸ¥é“äº†ã€‚Sessionä¹ŸåŒæ ·å¦‚æ­¤ï¼Œä½†å®ƒä¸å’ŒæœåŠ¡å™¨ç«¯é€šè®¯ï¼Œè¿™ç‚¹ä¸é›†åˆä¸åŒã€‚å› æ­¤ï¼ŒSessionéå¸¸é€‚åˆå­˜æ”¾UIçš„ä¸€äº›ä¸´æ—¶çŠ¶æ€ï¼Œæ¯”å¦‚ä¸Šä¾‹ä¸­çš„å¤é€‰æ¡†ã€‚å¦‚åŒé›†åˆï¼Œå½“Sessionå˜é‡å‘ç”Ÿå˜åŒ–åï¼Œæˆ‘ä»¬æ— éœ€ç¼–å†™å¤ªå¤šçš„ç¼–ç ã€‚ä»…éœ€è¦åœ¨å¸®åŠ©å™¨ï¼ˆhelper)æ–¹æ³•é‡Œè°ƒç”¨<code class="language-plaintext highlighter-rouge">Session.get(...)</code>å°±è¶³å¤Ÿäº†ã€‚</p>

<h3 id="æ›´å¤šæ˜¾ç¤ºå¾…å¤„ç†ä»»åŠ¡æ€»æ•°">æ›´å¤šï¼šæ˜¾ç¤ºå¾…å¤„ç†ä»»åŠ¡æ€»æ•°</h3>

<p>ç°åœ¨æˆ‘ä»¬å†™äº†ä¸€ä¸ªæŸ¥è¯¢ï¼Œå¯ä»¥ç­›é€‰å¾…å¤„ç†çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨åŒæ ·çš„æŸ¥è¯¢ï¼Œå»æ˜¾ç¤ºå¾…å¤„ç†ä»»åŠ¡çš„æ€»æ•°ã€‚åœ¨JavaScriptæ–‡ä»¶ä¸­å¢åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œä¿®æ”¹HTMLä¸€è¡Œä»£ç å°±å¯ä»¥å®ç°äº†ã€‚</p>

<p>åœ¨simple-todos.jsä¸­ä¿®æ”¹<code class="language-plaintext highlighter-rouge">Template.body.helpers(...)</code>ï¼Œå¢åŠ ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">incompleteCount</code>æ–¹æ³•ï¼Œä¿®æ”¹åçš„å¦‚ä¸‹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Template</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">helpers</span><span class="p">({</span>
    <span class="na">tasks</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">Session</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">hideCompleted</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// If hide completed is checked, filter tasks</span>
        <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="na">checked</span><span class="p">:</span> <span class="p">{</span><span class="na">$ne</span><span class="p">:</span> <span class="kc">true</span><span class="p">}},</span> <span class="p">{</span><span class="na">sort</span><span class="p">:</span> <span class="p">{</span><span class="na">createdAt</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Otherwise, return all of the tasks</span>
        <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="p">{</span><span class="na">sort</span><span class="p">:</span> <span class="p">{</span><span class="na">createdAt</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}});</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="na">hideCompleted</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Session</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">hideCompleted</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">incompleteCount</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="na">checked</span><span class="p">:</span> <span class="p">{</span><span class="na">$ne</span><span class="p">:</span> <span class="kc">true</span><span class="p">}}).</span><span class="nx">count</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>ä¿®æ”¹simple-todos.htmlæ–‡ä»¶ï¼Œæ˜¾ç¤ºå¾…å¤„ç†è®°å½•æ€»æ•°:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Todo List ({{incompleteCount}})<span class="nt">&lt;/h1&gt;</span>
</code></pre></div></div>

<h2 id="ä¹æ·»åŠ è´¦å·ç®¡ç†åŠŸèƒ½">ä¹ã€æ·»åŠ è´¦å·ç®¡ç†åŠŸèƒ½</h2>

<p>Meteorè‡ªå¸¦ä¸€ä¸ªè´¦å·ç³»ç»Ÿï¼Œä»¥åŠä¸‹æ‹‰å¼ç™»å½•é¡µé¢ã€‚å¯ä»¥è®©ä½ çš„åº”ç”¨åœ¨å‡ åˆ†é’Ÿå†…æ·»åŠ å¤šç”¨æˆ·åŠŸèƒ½ã€‚</p>

<p>ä¸ºäº†å¯ä»¥ä½¿ç”¨è´¦å·ç³»ç»Ÿä»¥åŠç›¸å…³çš„UIï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ç›¸å…³çš„åŒ…ã€‚åœ¨ä½ çš„åº”ç”¨æ‰€åœ¨ç›®å½•ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meteor add accounts-ui accounts-password
</code></pre></div></div>

<p>ä¸Šè¿°å‘½ä»¤è¿è¡Œå®Œåï¼ŒåŸå…ˆçš„meteoræœåŠ¡ä¼šè‡ªåŠ¨æ›´æ–°éƒ¨ç½²ã€‚æˆ‘ä»¬ç»§ç»­ä¸‹é¢æ“ä½œã€‚</p>

<p>åœ¨HTMLæ–‡ä»¶ä¸­ï¼Œå¤é€‰æ¡†çš„æ­£ä¸‹æ–¹ï¼Œæ·»åŠ ä¸€ä¸ªç”¨æˆ·ç™»å½•ä»£ç ï¼Œä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;header&gt;</span>
      <span class="nt">&lt;h1&gt;</span>Todo List ({{incompleteCount}})<span class="nt">&lt;/h1&gt;</span>

      <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"hide-completed"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">checked=</span><span class="s">"{{hideCompleted}}"</span> <span class="nt">/&gt;</span>
        Hide Completed Tasks
      <span class="nt">&lt;/label&gt;</span>

      {{&gt; loginButtons}}

      <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"new-task"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"Type to add new tasks"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/header&gt;</span>
</code></pre></div></div>

<p>é»˜è®¤çš„ç™»å½•ç•Œé¢æ˜¯ä½¿ç”¨é‚®ç®±åŠå¯†ç ç™»å½•ï¼Œæˆ‘ä»¬ä¿®æ”¹JavaScriptæ–‡ä»¶ï¼Œå¢åŠ ä¸‹é¢çš„ä»£ç æ¥é…ç½®ç™»å½•ç•Œé¢ï¼Œä½¿ç”¨ç”¨æˆ·åä»£æ›¿é‚®ç®±ç™»å½•ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Accounts</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
  <span class="na">passwordSignupFields</span><span class="p">:</span> <span class="dl">"</span><span class="s2">USERNAME_ONLY</span><span class="dl">"</span>
<span class="p">});</span>
</code></pre></div></div>

<p>ç°åœ¨ï¼Œä½¿ç”¨è€…å¯ä»¥åˆ›å»ºè´¦å·ç™»å½•ä½ çš„åº”ç”¨äº†ï¼åªæ˜¯ç™»å½•ç™»å‡ºå¹¶æ²¡æœ‰ä»€ä¹ˆæ•ˆæœã€‚è®©æˆ‘ä»¬å¢åŠ ä¸¤ä¸ªåŠŸèƒ½ï¼š</p>

<ol>
  <li>åªå¯¹ç™»é™†ç”¨æˆ·æ˜¾ç¤ºæ–°ä»»åŠ¡è¾“å…¥æ¡†ï¼›</li>
  <li>æ˜¾ç¤ºæˆ‘ä»¬åˆ›å»ºçš„æ¯ä¸ªä»»åŠ¡</li>
</ol>

<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code class="language-plaintext highlighter-rouge">task</code>é›†åˆä¸­å¢åŠ ä¸¤ä¸ªæ–°çš„å­—æ®µï¼š</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">owner</code> - åˆ›å»ºæ­¤ä»»åŠ¡çš„è´¦å·çš„<code class="language-plaintext highlighter-rouge">_id</code>ï¼›</li>
  <li><code class="language-plaintext highlighter-rouge">username</code> - åˆ›å»ºæ­¤ä»»åŠ¡çš„è´¦å·çš„<code class="language-plaintext highlighter-rouge">username</code>ã€‚æˆ‘ä»¬ç›´æ¥æŠŠ<code class="language-plaintext highlighter-rouge">username</code>ä¿å­˜åœ¨ä»»åŠ¡å¯¹è±¡ä¸­ï¼Œä»¥ä¾¿åœ¨æ˜¾ç¤ºä»»åŠ¡æ—¶ï¼Œæ— éœ€æ¯æ¬¡éƒ½å»å…³è”è´¦å·ä¿¡æ¯æŸ¥è¯¢ç”¨æˆ·åã€‚</li>
</ol>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨<code class="language-plaintext highlighter-rouge">submit .new-task</code>äº‹ä»¶å¤„ç†æ–¹æ³•ä¸­ï¼Œå¢åŠ ä¸€äº›ä»£ç å»ä¿å­˜æ–°å¢çš„å­—æ®µï¼Œä¿®æ”¹çš„ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Tasks</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span>
  <span class="na">text</span><span class="p">:</span> <span class="nx">text</span><span class="p">,</span>
  <span class="na">createdAt</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>            <span class="c1">// current time</span>
  <span class="na">owner</span><span class="p">:</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">userId</span><span class="p">(),</span>           <span class="c1">// _id of logged in user</span>
  <span class="na">username</span><span class="p">:</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">user</span><span class="p">().</span><span class="nx">username</span>  <span class="c1">// username of logged in user</span>
<span class="p">});</span>
</code></pre></div></div>

<p>æ¥ç€ï¼Œä¿®æ”¹HTMLæ–‡ä»¶ï¼Œå¢åŠ ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">#if</code>åˆ¤æ–­è¯­å¥ï¼Œä»…å½“è´¦å·ç™»å½•åæ‰æ˜¾ç¤ºä»»åŠ¡æ·»åŠ æ¡†ã€‚simple-todos.htmlä¸­ç›¸å…³ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{{#if currentUser}}
  <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"new-task"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"Type to add new tasks"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
{{/if}}
</code></pre></div></div>

<p>æœ€åï¼Œåœ¨æ¯ä¸ªä»»åŠ¡ä¿¡æ¯çš„å·¦è¾¹å¢åŠ ä¸€ä¸ªSpacebarsè¯­å¥å»æ˜¾ç¤ºç”¨æˆ·å(<code class="language-plaintext highlighter-rouge">username</code>)å­—æ®µã€‚</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"text"</span><span class="nt">&gt;&lt;strong&gt;</span>{{username}}<span class="nt">&lt;/strong&gt;</span> - {{text}}<span class="nt">&lt;/span&gt;</span>
</code></pre></div></div>

<p>å¥½äº†ï¼Œå¤§åŠŸå‘Šæˆäº†ï¼</p>

<h3 id="è‡ªåŠ¨è´¦å·ui">è‡ªåŠ¨è´¦å·UI</h3>

<p>å¦‚æœåº”ç”¨æ·»åŠ äº†<code class="language-plaintext highlighter-rouge">accounts-ui</code>åŒ…ï¼Œæƒ³å¢åŠ ä¸€ä¸ªä¸‹æ‹‰å¼ç™»å½•çª—å£ï¼Œåªéœ€ä½¿ç”¨<code class="language-plaintext highlighter-rouge">{{&gt; loginButtons}}</code>è¯­å¥æ¥è°ƒç”¨<code class="language-plaintext highlighter-rouge">loginButtons</code>æ¨¡ç‰ˆã€‚è¿™ä¸ªæ¨¡ç‰ˆä¼šè‡ªåŠ¨åˆ¤æ–­æ”¯æŒå“ªäº›ç™»å½•æ–¹å¼åŠæ˜¾ç¤ºç›¸å…³çš„æ§åˆ¶ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä»…å¼€å¯äº†è´¦å·å¯†ç (<code class="language-plaintext highlighter-rouge">accounts-password</code>)ç™»å½•æ–¹å¼ï¼Œæ‰€ä»¥ä¸‹æ‹‰çª—å£ä¸­åªæœ‰å¯†ç å­—æ®µã€‚å¦‚æœä½ æƒ³åšæ›´å¤šçš„å°è¯•ï¼Œä½ å¯ä»¥æ·»åŠ <code class="language-plaintext highlighter-rouge">accounts-facebook</code>åŒ…ï¼Œæ¥ç»™ä½ çš„åº”ç”¨å¼€å¯Facebookè´¦å·ç™»å½•åŠŸèƒ½ï¼Œè¿™æ ·ï¼ŒFacebookçš„æ¡ˆä¾‹å°±ä¼šè‡ªåŠ¨å‡ºç°åœ¨ä¸‹æ‹‰ç•Œé¢ä¸­äº†ã€‚</p>

<p>æƒ³å°è¯•å°±æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meteor add accounts-facebook
</code></pre></div></div>

<h3 id="å…³äºç™»å½•ç”¨æˆ·çš„æ›´å¤šä¿¡æ¯">å…³äºç™»å½•ç”¨æˆ·çš„æ›´å¤šä¿¡æ¯</h3>

<p>åœ¨HTMLä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…ç½®çš„å¸®åŠ©å™¨(helper)<code class="language-plaintext highlighter-rouge">{{currentUser}}</code>å»æ£€æŸ¥è´¦å·æ˜¯å¦ç™»å½•ï¼ŒåŠè·å–è´¦å·ç›¸å…³ä¿¡æ¯ã€‚æ¯”å¦‚ï¼š<code class="language-plaintext highlighter-rouge">{{currentUser.username}}</code>å¯ä»¥æ˜¾ç¤ºç™»å½•è´¦å·çš„ç”¨æˆ·åã€‚</p>

<p>åœ¨JavaScriptä»£ç ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">Meteor.userId()</code>è·å–å½“å‰è´¦å·çš„<code class="language-plaintext highlighter-rouge">_id</code>ï¼Œä½¿ç”¨<code class="language-plaintext highlighter-rouge">Meteor.user()</code>è·å–æ•´ä¸ªè´¦å·ä¿¡æ¯ã€‚</p>

<h2 id="åä½¿ç”¨methodsæ–¹æ³•å®ç°å®‰å…¨æ§åˆ¶">åã€ä½¿ç”¨<code class="language-plaintext highlighter-rouge">methods</code>æ–¹æ³•å®ç°å®‰å…¨æ§åˆ¶</h2>

<p>åœ¨è¿™ä¹‹å‰ï¼Œåº”ç”¨çš„æ¯ä¸ªè´¦å·éƒ½èƒ½ç¼–è¾‘æ•°æ®åº“ä¸­çš„ä¿¡æ¯ã€‚è¿™å¯¹ä¸€ä¸ªå†…éƒ¨å°åº”ç”¨æˆ–è€…å®ä¾‹è€Œè¨€ï¼Œå¯èƒ½æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ä½†ä»»ä½•ä¸€ä¸ªå®æ—¶åº”ç”¨éƒ½éœ€è¦å¯¹å®ƒçš„æ•°æ®è¿›è¡Œæƒé™æ§åˆ¶ã€‚åœ¨Meteorä¸­ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯å®šä¹‰<code class="language-plaintext highlighter-rouge">methods</code>æ–¹æ³•ï¼Œä»£æ›¿å®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨<code class="language-plaintext highlighter-rouge">insert</code>ã€<code class="language-plaintext highlighter-rouge">update</code>å’Œ<code class="language-plaintext highlighter-rouge">remove</code>æ–¹æ³•ã€‚å®ƒå°†æ£€æŸ¥è´¦å·æ˜¯å¦æœ‰æƒé™è¿›è¡Œå½“å‰æ“ä½œï¼Œæœ‰æƒé™åˆ™ä»¥å®¢æˆ·ç«¯åä¹‰ä¿®æ”¹æ•°æ®åº“ä¸­æ•°æ®ã€‚</p>

<h3 id="ç§»é™¤insecureåŒ…">ç§»é™¤<code class="language-plaintext highlighter-rouge">insecure</code>åŒ…</h3>

<p>æ¯ä¸ªæ–°åˆ›å»ºçš„Meteorå·¥ç¨‹éƒ½ä¼šé»˜è®¤æ·»åŠ <code class="language-plaintext highlighter-rouge">insecure</code>åŒ…ã€‚è¿™ä¸ªåŒ…å®¹è®¸ç”¨æˆ·ä»å®¢æˆ·ç«¯ä¿®æ”¹æ•°æ®åº“æ•°æ®ã€‚</p>

<p>ä½¿ç”¨ä¸‹é¢å‘½ä»¤å¯ä»¥åˆ é™¤è¿™ä¸ªåŒ…ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meteor remove insecure
</code></pre></div></div>

<p>ç§»é™¤è¿™ä¸ªåŒ…åï¼Œå†ä½¿ç”¨åº”ç”¨ï¼Œä½ å°†å‘ç°è¾“å…¥æ¡†å’ŒæŒ‰é’®ä¸å†æ­£å¸¸å·¥ä½œäº†ã€‚è¿™æ˜¯å› ä¸ºå®¢æˆ·ç«¯æ‰€æœ‰æ•°æ®åº“æƒé™éƒ½è¢«ç»ˆæ­¢äº†ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨<code class="language-plaintext highlighter-rouge">methods</code>é‡å†™åº”ç”¨çš„éƒ¨åˆ†åŠŸèƒ½ã€‚</p>

<h3 id="å®šä¹‰methods">å®šä¹‰methods</h3>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€äº›æ–¹æ³•.æˆ‘ä»¬éœ€è¦ä¸ºåœ¨å®¢æˆ·ç«¯æ‰§è¡Œçš„æ¯ä¸ªæ•°æ®åº“æ“ä½œå®šä¹‰ä¸€ä¸ªæ–¹æ³•ã€‚è¿™äº›æ–¹æ³•è¢«å®šä¹‰åœ¨å³è¢«æœåŠ¡ç«¯æ‰§è¡Œï¼Œä¹Ÿè¢«å®¢æˆ·ç«¯æ‰§è¡Œçš„ä»£ç ä¸­ã€‚</p>

<p>ä¿®æ”¹simple-todos.jsï¼Œå¢åŠ ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Meteor</span><span class="p">.</span><span class="nx">methods</span><span class="p">({</span>
  <span class="na">addTask</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Make sure the user is logged in before inserting a task</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">userId</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">not-authorized</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="nx">Tasks</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span>
      <span class="na">text</span><span class="p">:</span> <span class="nx">text</span><span class="p">,</span>
      <span class="na">createdAt</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
      <span class="na">owner</span><span class="p">:</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">userId</span><span class="p">(),</span>
      <span class="na">username</span><span class="p">:</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">user</span><span class="p">().</span><span class="nx">username</span>
    <span class="p">});</span>
  <span class="p">},</span>
  <span class="na">deleteTask</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">taskId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Tasks</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">taskId</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="na">setChecked</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">taskId</span><span class="p">,</span> <span class="nx">setChecked</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Tasks</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">taskId</span><span class="p">,</span> <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">checked</span><span class="p">:</span> <span class="nx">setChecked</span><span class="p">}</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>å¥½äº†ï¼Œæ–¹æ³•éƒ½å®šä¹‰å¥½äº†ã€‚æˆ‘ä»¬æŠŠä¹‹å‰å¯¹é›†åˆæ“ä½œçš„ä»£ç éƒ½ç”¨è¿™äº›æ–¹æ³•æ›¿æ¢ã€‚</p>

<p>ä¿®æ”¹åçš„å®Œæ•´çš„simple-todos.jsæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Tasks</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mongo</span><span class="p">.</span><span class="nx">Collection</span><span class="p">(</span><span class="dl">"</span><span class="s2">tasks</span><span class="dl">"</span><span class="p">);</span>
 
<span class="k">if</span> <span class="p">(</span><span class="nx">Meteor</span><span class="p">.</span><span class="nx">isClient</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// This code only runs on the client</span>
  <span class="nx">Template</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">helpers</span><span class="p">({</span>
    <span class="na">tasks</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">Session</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">hideCompleted</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// If hide completed is checked, filter tasks</span>
        <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="na">checked</span><span class="p">:</span> <span class="p">{</span><span class="na">$ne</span><span class="p">:</span> <span class="kc">true</span><span class="p">}},</span> <span class="p">{</span><span class="na">sort</span><span class="p">:</span> <span class="p">{</span><span class="na">createdAt</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Otherwise, return all of the tasks</span>
        <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="p">{</span><span class="na">sort</span><span class="p">:</span> <span class="p">{</span><span class="na">createdAt</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}});</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="na">hideCompleted</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Session</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">hideCompleted</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">incompleteCount</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="na">checked</span><span class="p">:</span> <span class="p">{</span><span class="na">$ne</span><span class="p">:</span> <span class="kc">true</span><span class="p">}}).</span><span class="nx">count</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">Template</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">events</span><span class="p">({</span>
    <span class="dl">"</span><span class="s2">submit .new-task</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Prevent default browser form submit</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
 
      <span class="c1">// Get value from form element</span>
      <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
 
      <span class="c1">// Insert a task into the collection</span>
      <span class="nx">Meteor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="dl">"</span><span class="s2">addTask</span><span class="dl">"</span><span class="p">,</span> <span class="nx">text</span><span class="p">);</span>
 
      <span class="c1">// Clear form</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="dl">"</span><span class="s2">change .hide-completed input</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">Session</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">hideCompleted</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">checked</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">Template</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">events</span><span class="p">({</span>
    <span class="dl">"</span><span class="s2">click .toggle-checked</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="c1">// Set the checked property to the opposite of its current value</span>
      <span class="nx">Meteor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="dl">"</span><span class="s2">setChecked</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> <span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">checked</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">click .delete</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">Meteor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="dl">"</span><span class="s2">deleteTask</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">Accounts</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
    <span class="na">passwordSignupFields</span><span class="p">:</span> <span class="dl">"</span><span class="s2">USERNAME_ONLY</span><span class="dl">"</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">Meteor</span><span class="p">.</span><span class="nx">methods</span><span class="p">({</span>
  <span class="na">addTask</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Make sure the user is logged in before inserting a task</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">userId</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">not-authorized</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="nx">Tasks</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span>
      <span class="na">text</span><span class="p">:</span> <span class="nx">text</span><span class="p">,</span>
      <span class="na">createdAt</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
      <span class="na">owner</span><span class="p">:</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">userId</span><span class="p">(),</span>
      <span class="na">username</span><span class="p">:</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">user</span><span class="p">().</span><span class="nx">username</span>
    <span class="p">});</span>
  <span class="p">},</span>
  <span class="na">deleteTask</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">taskId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Tasks</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">taskId</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="na">setChecked</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">taskId</span><span class="p">,</span> <span class="nx">setChecked</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Tasks</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">taskId</span><span class="p">,</span> <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">checked</span><span class="p">:</span> <span class="nx">setChecked</span><span class="p">}</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>å¥½äº†ï¼Œæˆ‘ä»¬çš„è¾“å…¥æ¡†å’ŒæŒ‰é’®åˆå¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼ç¨å¾®æ€»ç»“ä¸€ä¸‹æœ¬ç« èŠ‚æ”¶è·ï¼š</p>

<ol>
  <li>å½“æˆ‘ä»¬å‘æ•°æ®åº“æ’å…¥ä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›å®‰å…¨æ€§æ ¡éªŒï¼Œæ¯”å¦‚ï¼šç”¨æˆ·æ˜¯å¦ç™»å½•ï¼›åˆ›å»ºæ—¶é—´ã€ç”¨æˆ·åç­‰å­—æ®µæ˜¯å¦æ­£ç¡®ã€‚ä½¿ç”¨è€…æ— æ³•å‡å†’ä»»ä½•äººã€‚</li>
  <li>å½“ä»»åŠ¡è¢«ç§æœ‰åŒ–æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code class="language-plaintext highlighter-rouge">setChecked</code>å’Œ<code class="language-plaintext highlighter-rouge">deleteTask</code>æ–¹æ³•ä¸­å¢åŠ ä¸€äº›é€»è¾‘æ ¡éªŒã€‚ï¼ˆåæ–‡ä¼šä»‹ç»ï¼‰</li>
  <li>å®¢æˆ·ç«¯ä»£ç ä¸æ•°æ®åº“é€»è¾‘æ›´åŠ åˆ†ç¦»äº†ã€‚æˆ‘ä»¬æç‚¼ä¸€äº›æ–¹æ³•å¯ä»¥åœ¨å„å¤„è¢«è°ƒç”¨ï¼Œè€Œä¸å†æ˜¯å¤§é‡é€»è¾‘éƒ½æ”¾åœ¨é¡µé¢çš„äº‹ä»¶å¤„ç†æ–¹æ³•é‡Œäº†ã€‚</li>
</ol>

<h3 id="optimistic-ui">Optimistic UI</h3>

<p>é‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦åŒæ—¶å®šä¹‰æˆ‘ä»¬çš„æ–¹æ³•åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ï¼Ÿæˆ‘ä»¬è¿™æ ·åšæ˜¯ä¸ºäº†å®ç°ä¸€ä¸ªæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œoptimistic UIâ€çš„ç‰¹æ•ˆã€‚</p>

<p>å½“æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯ä½¿ç”¨<code class="language-plaintext highlighter-rouge">Meteor.call</code>è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼ŒMeteorä¼šåŒæ—¶åšä¸¤ä»¶äº‹ï¼š</p>

<ol>
  <li>å®¢æˆ·ç«¯å‘é€è¯·æ±‚è‡³æœåŠ¡å™¨ç«¯ï¼Œåœ¨ä¸€ä¸ªå®‰å…¨çš„ç¯å¢ƒä¸‹å»è¿è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œå¦‚åŒAJAXè¯·æ±‚ä¸€æ ·å·¥ä½œï¼›</li>
  <li>è¯•å›¾é¢„æµ‹æœåŠ¡å™¨ç«¯æ­£å¸¸çš„å¤„ç†ç»“æœï¼Œè€Œåœ¨å®¢æˆ·ç«¯æ¨¡ä»¿è¿™ä¸ªæ–¹æ³•è¿è¡Œã€‚</li>
</ol>

<p>è¿™å°±æ„å‘³ç€ï¼Œä¸€ä¸ªæ–°åˆ›å»ºçš„ä»»åŠ¡ï¼Œè¿˜æœªä»æœåŠ¡å™¨ç«¯æ¥æ”¶åé¦ˆç»“æœï¼Œå°±ç«‹åˆ»å‡ºç°åœ¨é¡µé¢ä¸Šäº†ã€‚</p>

<p>å¦‚æœæœåŠ¡ç«¯è¿”å›çš„ç»“æœå’Œå®¢æˆ·ç«¯æ¨¡æ‹Ÿçš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆä¸å†åšä»»ä½•å¤„ç†ï¼›ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆUIå°†æŒ‰ç…§æœåŠ¡ç«¯è¿”å›ç»“æœè¿›è¡Œä¿®æ­£ã€‚</p>

<p>åˆ©ç”¨Meteorçš„æ–¹æ³•ï¼ˆmethodsï¼‰å’Œoptimistic UIï¼Œæˆ‘ä»¬å¯ä»¥é±¼ä¸ç†ŠæŒå…¼å¾—â€”â€”æœåŠ¡ç«¯ä»£ç å®‰å…¨ä¸æ— å»¶è¿Ÿäº¤äº’ï¼</p>

<h2 id="åä¸€åˆ©ç”¨å‘å¸ƒä¸è®¢é˜…æ¥è¿‡æ»¤æ•°æ®">åä¸€ã€åˆ©ç”¨å‘å¸ƒä¸è®¢é˜…æ¥è¿‡æ»¤æ•°æ®</h2>

<p>æˆ‘ä»¬å·²ç»æŠŠåº”ç”¨çš„æ‰€æœ‰æ•æ„Ÿä»£ç éƒ½ç§»åˆ°äº†Methodsé‡Œäº†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦äº†è§£ä¸€äº›Meteorå…¶ä»–çš„å®‰å…¨çŸ¥è¯†ã€‚æˆªæ­¢ç›®å‰ï¼Œæˆ‘ä»¬çš„å·¥ä½œéƒ½æ˜¯åŸºäºå‡è®¾æ•´ä¸ªæ•°æ®åº“éƒ½åœ¨å®¢æˆ·ç«¯çš„åŸºç¡€ä¸Šçš„ï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœè°ƒç”¨<code class="language-plaintext highlighter-rouge">Tasks.find()</code>ï¼Œæˆ‘ä»¬å°†ä»é›†åˆä¸­æŸ¥è¯¢æ‰€æœ‰æ•°æ®ã€‚å¦‚æœåº”ç”¨çš„ä½¿ç”¨è€…æƒ³å­˜å‚¨ä¸€äº›éšç§æ•°æ®ï¼Œè¿™ä¸ªæœºåˆ¶å°±ä¸åˆé€‚äº†ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–¹æ¡ˆå»æ§åˆ¶å“ªäº›æ•°æ®å¯ä»¥å‘é€åˆ°å®¢æˆ·ç«¯æ•°æ®åº“ã€‚</p>

<p>å¦‚åŒ<code class="language-plaintext highlighter-rouge">insecure</code>åŒ…ä¸€æ ·ï¼ŒMeteoræ–°åˆ›å»ºçš„æ¯ä¸ªæ–°åº”ç”¨éƒ½ä¼šè‡ªå¸¦ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">autopublish</code>åŒ…ã€‚</p>

<p>æˆ‘ä»¬åˆ é™¤è¿™ä¸ªåŒ…ï¼Œçœ‹çœ‹å‘ç”Ÿäº†ä»€ä¹ˆï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meteor remove autopublish
</code></pre></div></div>

<p>å½“åº”ç”¨åˆ·æ–°åï¼Œä»»åŠ¡æ¸…å•å°±ç©ºäº†ã€‚æ²¡æœ‰äº†è¿™ä¸ªåŒ…ï¼Œæˆ‘ä»¬éœ€è¦æ˜¾ç¤ºåœ°åˆ—å‡ºéœ€è¦æœåŠ¡å™¨ç«¯å‘é€å“ªäº›æ•°æ®åˆ°å®¢æˆ·ç«¯ã€‚Meteorä¸­å®ç°è¿™ä¸ªåŠŸèƒ½çš„å‡½æ•°æ˜¯<code class="language-plaintext highlighter-rouge">Meteor.publish</code>å’Œ<code class="language-plaintext highlighter-rouge">Meteor.subscrib</code>.</p>

<p>åœ¨simple-todos.jsæ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹ä»£ç ç‰‡æ®µ:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">Meteor</span><span class="p">.</span><span class="nx">isServer</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// This code only runs on the server</span>
  <span class="nx">Meteor</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="dl">"</span><span class="s2">tasks</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">Meteor</span><span class="p">.</span><span class="nx">isClient</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// This code only runs on the client</span>
  <span class="nx">Meteor</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="dl">"</span><span class="s2">tasks</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ç­‰å¾…ä»£ç â€çƒ­éƒ¨ç½²â€œåï¼Œé¡µé¢çš„ä»»åŠ¡æ¸…å•åˆå‡ºç°äº†ã€‚</p>

<p>æœåŠ¡å™¨ç«¯é€šè¿‡è°ƒç”¨<code class="language-plaintext highlighter-rouge">Meteor.publish</code>æ–¹æ³•ï¼Œæ³¨å†Œäº†ä¸€ä¸ªåä¸º<code class="language-plaintext highlighter-rouge">"tasks"</code>çš„å‘å¸ƒã€‚åœ¨å®¢æˆ·ç«¯ï¼Œä½¿ç”¨è¿™ä¸ªå‘å¸ƒåè°ƒç”¨<code class="language-plaintext highlighter-rouge">Meteor.subscribe</code>æ–¹æ³•ï¼Œè¿™ä¸ªå®¢æˆ·ç«¯å°±è®¢é˜…äº†æ‰€æœ‰æ¥è‡ªå‘å¸ƒå‘å¸ƒçš„æ•°æ®ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå°±æ‰€æœ‰çš„ä»»åŠ¡æ¸…å•ã€‚</p>

<p>ä¸ºäº†çœŸå®åœ°å±•ç¤ºå‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„å¼ºå¤§ä¹‹å¤„ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªåŠŸèƒ½ï¼Œå®¹è®¸è´¦å·å»æ ‡è®°ä»»åŠ¡ä¸ºâ€ç§äººçš„â€ï¼Œä»¥ä¾¿ä¸è¢«å…¶ä»–è´¦å·çœ‹è§ã€‚</p>

<h3 id="å®ç°ç§äººä»»åŠ¡">å®ç°ç§äººä»»åŠ¡</h3>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬ç»™ä»»åŠ¡è®°å½•å¢åŠ ä¸€ä¸ªåä¸ºâ€privateâ€çš„å±æ€§ï¼Œç»™ç”¨æˆ·æä¾›ä¸€ä¸ªæŒ‰é’®ï¼Œå»æ ‡è®°ä»»åŠ¡æ˜¯å¦æ˜¯ç§äººçš„ã€‚è¿™ä¸ªæŒ‰é’®åªæ˜¾ç¤ºç»™ä»»åŠ¡çš„æ‰€æœ‰è€…ï¼Œå¹¶ä¸”å°†æ˜¾ç¤ºä»»åŠ¡å½“å‰æ‰€å¤„çš„çŠ¶æ€ã€‚</p>

<p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜è¦ç»™ä»»åŠ¡è®°å½•å¢åŠ ä¸€ä¸ªå¼æ ·ç±»ï¼Œç”¨æ¥æ ‡è®°è¿™ä¸ªä»»åŠ¡æ˜¯å¦ä¸ºç§äººçš„ã€‚</p>

<p>simple-todos.htmlä¸­taskæ¨¡ç‰ˆä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;template</span> <span class="na">name=</span><span class="s">"task"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"{{#if checked}}checked{{/if}}  {{#if private}}private{{/if}}"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"delete"</span><span class="nt">&gt;</span><span class="ni">&amp;times;</span><span class="nt">&lt;/button&gt;</span>
 
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">checked=</span><span class="s">"{{checked}}"</span> <span class="na">class=</span><span class="s">"toggle-checked"</span> <span class="nt">/&gt;</span>

    {{#if isOwner}}
      <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"toggle-private"</span><span class="nt">&gt;</span>
        {{#if private}}
          Private
        {{else}}
          Public
        {{/if}}
      <span class="nt">&lt;/button&gt;</span>
    {{/if}}
 
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"text"</span><span class="nt">&gt;&lt;strong&gt;</span>{{username}}<span class="nt">&lt;/strong&gt;</span> - {{text}}<span class="nt">&lt;/span&gt;</span>
  <span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/template&gt;</span>
</code></pre></div></div>

<p>ç»“åˆé¡µé¢æ‰€åšçš„ä¿®æ”¹ï¼Œæˆ‘ä»¬éœ€è¦åŒæ—¶ä¿®æ”¹ä¸‰å¤„JavaScriptä»£ç ï¼š</p>

<ol>
  <li>
    <p>å¢åŠ ä¸€ä¸ªåä¸º<code class="language-plaintext highlighter-rouge">isOwner</code>çš„å¸®åŠ©å™¨(helper)</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">Template</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">helpers</span><span class="p">({</span>
   <span class="na">isOwner</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
   	<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">owner</span> <span class="o">===</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">userId</span><span class="p">();</span>
   <span class="p">}</span>
  	<span class="p">});</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>å¢åŠ ä¸€ä¸ªåä¸º<code class="language-plaintext highlighter-rouge">setPrivate</code>çš„Meteoræ–¹æ³•ã€‚</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">setPrivate</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">taskId</span><span class="p">,</span> <span class="nx">setToPrivate</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">var</span> <span class="nx">task</span> <span class="o">=</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span><span class="nx">taskId</span><span class="p">);</span>
 
   <span class="c1">// Make sure only the task owner can make a task privateå‘å¸ƒ</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">task</span><span class="p">.</span><span class="nx">owner</span> <span class="o">!==</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">userId</span><span class="p">())</span> <span class="p">{</span>
     <span class="k">throw</span> <span class="k">new</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">not-authorized</span><span class="dl">"</span><span class="p">);</span>
   <span class="p">}</span>
 
   <span class="nx">Tasks</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">taskId</span><span class="p">,</span> <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">private</span><span class="p">:</span> <span class="nx">setToPrivate</span> <span class="p">}</span> <span class="p">});</span>
  <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>å¢åŠ ä¸€ä¸ªæŒ‰é’®ç‚¹å‡»äº‹ä»¶æ–¹æ³•ã€‚</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="dl">"</span><span class="s2">click .toggle-private</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
   <span class="nx">Meteor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="dl">"</span><span class="s2">setPrivate</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> <span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="kr">private</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="åŸºäºéšç§çŠ¶æ€æœ‰é€‰æ‹©åœ°å‘å¸ƒä»»åŠ¡">åŸºäºéšç§çŠ¶æ€æœ‰é€‰æ‹©åœ°å‘å¸ƒä»»åŠ¡</h3>

<p>æˆ‘ä»¬å·²ç»å¯ä»¥è®¾ç½®å“ªäº›ä»»åŠ¡æ˜¯ç§äººçš„äº†ï¼Œæˆ‘ä»¬ç»§ç»­å®Œå–„æˆ‘ä»¬çš„å‘å¸ƒç¨‹åºï¼Œåªå‘é€æ•°æ®ç»™æœ‰æƒé™çš„ç”¨æˆ·æµè§ˆã€‚</p>

<p>ä¿®æ”¹simple-todos.jsä¸­ç›¸å…³ä»£ç ï¼Œç›¸å…³ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">Meteor</span><span class="p">.</span><span class="nx">isServer</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// This code only runs on the server</span>
  <span class="c1">// Only publish tasks that are public or belong to the current user</span>
  <span class="nx">Meteor</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="dl">"</span><span class="s2">tasks</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
      <span class="na">$or</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="na">private</span><span class="p">:</span> <span class="p">{</span><span class="na">$ne</span><span class="p">:</span> <span class="kc">true</span><span class="p">}</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">owner</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">userId</span> <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æˆ‘ä»¬å¯ä»¥æ‰“å¼€ä¸¤ä¸ªæµè§ˆå™¨ï¼Œä½¿ç”¨ä¸åŒçš„è´¦å·ç™»å½•ï¼Œæ¥æµ‹è¯•æ•ˆæœã€‚</p>

<h3 id="å®Œå–„å®‰å…¨æ§åˆ¶">å®Œå–„å®‰å…¨æ§åˆ¶</h3>

<p>ä¸ºäº†å®Œå–„æˆ‘ä»¬çš„ç§äººä»»åŠ¡åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ç»™<code class="language-plaintext highlighter-rouge">deleteTask</code>å’Œ<code class="language-plaintext highlighter-rouge">setChecked</code>ä¿©æ–¹æ³•å¢åŠ æ£€æŸ¥ï¼Œä»¥ä¾¿ä»»åŠ¡çš„æ‰€æœ‰è€…å¯ä»¥åˆ é™¤æˆ–å®Œæˆä¸€ä¸ªç§äººä»»åŠ¡ã€‚</p>

<p>å®Œæ•´çš„simple-todos.jsæ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Tasks</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mongo</span><span class="p">.</span><span class="nx">Collection</span><span class="p">(</span><span class="dl">"</span><span class="s2">tasks</span><span class="dl">"</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">Meteor</span><span class="p">.</span><span class="nx">isServer</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// This code only runs on the server</span>
  <span class="c1">// Only publish tasks that are public or belong to the current user</span>
  <span class="nx">Meteor</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="dl">"</span><span class="s2">tasks</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
      <span class="na">$or</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="na">private</span><span class="p">:</span> <span class="p">{</span><span class="na">$ne</span><span class="p">:</span> <span class="kc">true</span><span class="p">}</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">owner</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">userId</span> <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>
 
<span class="k">if</span> <span class="p">(</span><span class="nx">Meteor</span><span class="p">.</span><span class="nx">isClient</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// This code only runs on the client</span>
  <span class="nx">Meteor</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="dl">"</span><span class="s2">tasks</span><span class="dl">"</span><span class="p">);</span>

  <span class="nx">Template</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">helpers</span><span class="p">({</span>
    <span class="na">tasks</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">Session</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">hideCompleted</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// If hide completed is checked, filter tasks</span>
        <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="na">checked</span><span class="p">:</span> <span class="p">{</span><span class="na">$ne</span><span class="p">:</span> <span class="kc">true</span><span class="p">}},</span> <span class="p">{</span><span class="na">sort</span><span class="p">:</span> <span class="p">{</span><span class="na">createdAt</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Otherwise, return all of the tasks</span>
        <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="p">{</span><span class="na">sort</span><span class="p">:</span> <span class="p">{</span><span class="na">createdAt</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}});</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="na">hideCompleted</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Session</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">hideCompleted</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">incompleteCount</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="na">checked</span><span class="p">:</span> <span class="p">{</span><span class="na">$ne</span><span class="p">:</span> <span class="kc">true</span><span class="p">}}).</span><span class="nx">count</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">Template</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">events</span><span class="p">({</span>
    <span class="dl">"</span><span class="s2">submit .new-task</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Prevent default browser form submit</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
 
      <span class="c1">// Get value from form element</span>
      <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
 
      <span class="c1">// Insert a task into the collection</span>
      <span class="nx">Meteor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="dl">"</span><span class="s2">addTask</span><span class="dl">"</span><span class="p">,</span> <span class="nx">text</span><span class="p">);</span>
 
      <span class="c1">// Clear form</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="dl">"</span><span class="s2">change .hide-completed input</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">Session</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">hideCompleted</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">checked</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">Template</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">helpers</span><span class="p">({</span>
    <span class="na">isOwner</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">owner</span> <span class="o">===</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">userId</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">Template</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">events</span><span class="p">({</span>
    <span class="dl">"</span><span class="s2">click .toggle-checked</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="c1">// Set the checked property to the opposite of its current value</span>
      <span class="nx">Meteor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="dl">"</span><span class="s2">setChecked</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> <span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">checked</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">click .delete</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">Meteor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="dl">"</span><span class="s2">deleteTask</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">click .toggle-private</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">Meteor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="dl">"</span><span class="s2">setPrivate</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> <span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="kr">private</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">Accounts</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
    <span class="na">passwordSignupFields</span><span class="p">:</span> <span class="dl">"</span><span class="s2">USERNAME_ONLY</span><span class="dl">"</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">Meteor</span><span class="p">.</span><span class="nx">methods</span><span class="p">({</span>
  <span class="na">addTask</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Make sure the user is logged in before inserting a task</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">userId</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">not-authorized</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="nx">Tasks</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span>
      <span class="na">text</span><span class="p">:</span> <span class="nx">text</span><span class="p">,</span>
      <span class="na">createdAt</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
      <span class="na">owner</span><span class="p">:</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">userId</span><span class="p">(),</span>
      <span class="na">username</span><span class="p">:</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">user</span><span class="p">().</span><span class="nx">username</span>
    <span class="p">});</span>
  <span class="p">},</span>
  <span class="na">deleteTask</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">taskId</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">task</span> <span class="o">=</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span><span class="nx">taskId</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">task</span><span class="p">.</span><span class="kr">private</span> <span class="o">&amp;&amp;</span> <span class="nx">task</span><span class="p">.</span><span class="nx">owner</span> <span class="o">!==</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">userId</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// If the task is private, make sure only the owner can delete it</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">not-authorized</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">Tasks</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">taskId</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="na">setChecked</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">taskId</span><span class="p">,</span> <span class="nx">setChecked</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">task</span> <span class="o">=</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span><span class="nx">taskId</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">task</span><span class="p">.</span><span class="kr">private</span> <span class="o">&amp;&amp;</span> <span class="nx">task</span><span class="p">.</span><span class="nx">owner</span> <span class="o">!==</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">userId</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// If the task is private, make sure only the owner can check it off</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">not-authorized</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">Tasks</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">taskId</span><span class="p">,</span> <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">checked</span><span class="p">:</span> <span class="nx">setChecked</span><span class="p">}</span> <span class="p">});</span>
  <span class="p">},</span>
  <span class="na">setPrivate</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">taskId</span><span class="p">,</span> <span class="nx">setToPrivate</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">task</span> <span class="o">=</span> <span class="nx">Tasks</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span><span class="nx">taskId</span><span class="p">);</span>
 
    <span class="c1">// Make sure only the task owner can make a task private</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">task</span><span class="p">.</span><span class="nx">owner</span> <span class="o">!==</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">userId</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">not-authorized</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="nx">Tasks</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">taskId</span><span class="p">,</span> <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">private</span><span class="p">:</span> <span class="nx">setToPrivate</span> <span class="p">}</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<blockquote>
  <p>â€œæ³¨æ„ç°åœ¨ä»»ä½•äººéƒ½å¯ä»¥åˆ é™¤å…¬å…±ä»»åŠ¡ï¼Œä»£ç å†åšä¸€äº›å¾®è°ƒï¼Œå°±å¯ä»¥å®ç°ä»…ä»»åŠ¡çš„æ‰€æœ‰è€…æ‰èƒ½åˆ é™¤ä»–ä»¬â€</p>
</blockquote>

<p>å¥½äº†ï¼Œæˆ‘ä»¬å®Œæˆäº†ä¸ªäººä»»åŠ¡åŠŸèƒ½ï¼ç°åœ¨æˆ‘ä»¬çš„åº”ç”¨å·²ç»å®‰å…¨äº†ï¼Œå¯ä»¥é˜²æ­¢æ”»å‡»è€…æµè§ˆæˆ–è€…ä¿®æ”¹ä»–äººçš„ä»»åŠ¡äº†ï¼</p>

:ET