I"i<h2 id="ä¸€eventproxyç®€ä»‹">ä¸€ã€EventProxyç®€ä»‹</h2>
<p>EventProxyä½œè€… ç”°æ°¸å¼ºï¼Œæ–°æµªå¾®åš@æœ´çµï¼Œå‰ç«¯å·¥ç¨‹å¸ˆï¼Œæ›¾å°±èŒäºSAPï¼Œç°å°±èŒäºæ·˜å®ï¼ŒèŠ±åæœ´çµï¼Œè‡´åŠ›äºNodeJSå’ŒMobile Web Appæ–¹é¢çš„ç ”å‘å·¥ä½œã€‚EventProxy ä»…ä»…æ˜¯ä¸€ä¸ªå¾ˆè½»é‡çš„å·¥å…·ï¼Œä½†æ˜¯èƒ½å¤Ÿå¸¦æ¥ä¸€ç§äº‹ä»¶å¼ç¼–ç¨‹çš„æ€ç»´å˜åŒ–ã€‚æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p>

<p>1.åˆ©ç”¨äº‹ä»¶æœºåˆ¶è§£è€¦å¤æ‚ä¸šåŠ¡é€»è¾‘ï¼›</p>

<p>2.ç§»é™¤è¢«å¹¿ä¸ºè¯Ÿç—…çš„æ·±åº¦callbackåµŒå¥—é—®é¢˜ï¼›</p>

<p>3.å°†ä¸²è¡Œç­‰å¾…å˜æˆå¹¶è¡Œç­‰å¾…ï¼Œæå‡å¤šå¼‚æ­¥åä½œåœºæ™¯ä¸‹çš„æ‰§è¡Œæ•ˆç‡ï¼›</p>

<p>4.å‹å¥½çš„Error handlingï¼›</p>

<p>5.æ— å¹³å°ä¾èµ–ï¼Œé€‚åˆå‰åç«¯ï¼Œèƒ½ç”¨äºæµè§ˆå™¨å’ŒNode.jsï¼›</p>

<p>6.å…¼å®¹CMDï¼ŒAMDä»¥åŠCommonJSæ¨¡å—ç¯å¢ƒã€‚</p>

<h3 id="äºŒå®‰è£…">äºŒã€å®‰è£…</h3>

<p>é€šè¿‡NPMå®‰è£…å³å¯ä½¿ç”¨ï¼š$ npm install eventproxy</p>

<p>è°ƒç”¨:var EventProxy = require(â€˜eventproxyâ€™);</p>

<h3 id="ä¸‰ä½¿ç”¨">ä¸‰ã€ä½¿ç”¨</h3>

<p>è¿™é‡Œåªç®€å•ä»‹ç»EventProxyåœ¨nodeç¯å¢ƒä¸­çš„åº”ç”¨ï¼Œè‡³äºå‰ç«¯åŠå…¶ä»–ç¯å¢ƒä½¿ç”¨è§ï¼šhttps://github.com/JacksonTian/eventproxyã€‚</p>

<p>1.è¿‡å»å¼‚æ­¥çš„I/Oæ“ä½œæ—¶ï¼Œå¾ˆå®¹æ˜“ä¼šå†™æˆå›è°ƒå‡½æ•°æ·±åº¦åµŒå¥—ï¼Œå¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var add= function (v1, v2, v3){
   console.log(v1+v2+v3+'');
};

var value1,value2,value3

clinet.get("key1", function (err, data) {
    // do something
     value1 = data

    clinet.get("key2", function (err, data) {
        // do something
        value2=data
        clinet.get("key3", function (err, data) {
            //do something
             value3 = data
            add(value1, value2, value3);
        });

    });

});
</code></pre></div></div>

<p>2.ä½¿ç”¨EventProxyåå¯ä»¥æ›´å¤šå…³å¿ƒä¸šåŠ¡ï¼Œå»æ‰æ·±åº¦åµŒå¥—ï¼Œå¹¶ä¸”åœ¨ä¸€äº›æƒ…å†µä¸‹æ˜¾è‘—æé«˜æ•ˆç‡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> var EventProxy = require('./eventproxy');
 	 var proxy = new EventProxy();
 var add= function (v1, v2, v3){
   console.log(v1+v2+v3+'');
 };

 proxy.assign("v1", "v2", "v3", add);
 clinet1.get("key1", function (err, data) {
    //do something
    proxy.trigger("v1", data);

 });

 clinet2.get("data", function (err, data) {
    //do something
    proxy.trigger("v2", data);

 });

 clinet3.get("l10n", function (err, data) {
    //do something
    proxy.trigger("v3", data);

 });
</code></pre></div></div>

<p>3.EventProxyåœ¨æ—¥å¿—åˆ†æç³»ç»Ÿä¸­çš„åº”ç”¨</p>

<p>ä»¥ä¸‹ä¸ºæ—¥å¿—ç³»ç»Ÿä¸­æœåŠ¡å¯åŠ¨åŠ è½½èœå•çš„ç¨‹åºï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var fs = require('fs')ï¼Œ
EventProxy = require('eventproxy').EventProxy;


exports.loadMenu = function(dir,cb){
   	
var proxy = new EventProxy();
  proxy.assign('menus', cb);
fs.readdir(dir, function(err, files) {

    var menusTemp = [];
    if(err) {
        throw new Error(err);
    }

    files.forEach(function(filename) {
        if(filename.substring(filename.length-3) == '.js'){
            var filepath = [ dir, filename ].join('/');
            var tmp = require(filepath);
            for (m in tmp){
                menusTemp.push(tmp[m]);
            }
        }
    });  
         
    proxy.trigger('menus', menusTemp);
 }); 
}
</code></pre></div></div>

<p>å…¶ä¸­loadMenuæ˜¯åœ¨æœåŠ¡å¯åŠ¨æ˜¯è¢«è°ƒç”¨ï¼Œä¼ å…¥çš„å‚æ•°ä¸ºèœå•æ–‡ä»¶è·¯å¾„ã€å›è°ƒå‡½æ•°ï¼Œç¨‹åºé¦–å…ˆé€šè¿‡
proxy.assign(â€˜menusâ€™, cb);ç›‘å¬menusï¼Œåœ¨ç¨‹åºè¯»å–å®Œèœå•æ–‡ä»¶åè°ƒç”¨ proxy.trigger(â€˜menusâ€™, menusTemp);è§¦å‘cbå›è°ƒå‡½æ•°ï¼Œå‚æ•°ä¸ºmenusTempã€‚</p>
:ET