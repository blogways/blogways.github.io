I"Ü6<h2 id="ä½¿ç”¨xmlé…ç½®æ–‡ä»¶åŠ è½½quartz">ä½¿ç”¨xmlé…ç½®æ–‡ä»¶åŠ è½½quartz</h2>

<p>åœ¨ä¸ŠèŠ‚ä»‹ç»ä¸­å¹¶æ²¡æœ‰ç”¨åˆ°ä»»ä½•çš„é…ç½®æ–‡ä»¶ï¼Œè€Œåœ¨æˆ‘ä»¬é¡¹ç›®å·¥ç¨‹ä¸­å¸¸ä½¿ç”¨xmlæ¥åŠ è½½ã€‚Quartzæ”¯æŒé…ç½®æ–‡ä»¶ï¼Œå®ƒçš„å¥½å¤„æ˜¯æ¯”ç¼–å†™ä»£ç ç®€å•ï¼Œä¸”ä¿®æ”¹åä¸éœ€è¦é‡æ–°ç¼–è¯‘æºç </p>

<ul>
  <li>é…ç½®quartz.propertiesæ–‡ä»¶</li>
</ul>

<p>è¯¥æ–‡ä»¶æ¥é…ç½®quartzçš„å„ç§å±æ€§ï¼ŒåŒ…æ‹¬çº¿ç¨‹æ•°ï¼Œçº¿ç¨‹ä¼˜å…ˆçº§ï¼ŒåŠ è½½çš„jobæ–‡ä»¶ï¼Œæ‰«æçš„æ—¶é—´é—´éš”ç­‰ä¸€ç³»åˆ—å±æ€§</p>

<p>æ–°å»ºquartz.propertiesåœ¨é¡¹ç›®çš„classpathä¸‹ï¼ŒåŠ è½½å¿…è¦çš„jaråŒ…</p>

<p>é¡¹ç›®ä»£ç ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#============================================================================  
# Configure Main Scheduler Properties  
#============================================================================

# å®ä¾‹å
org.quartz.scheduler.instanceName = QuartzScheduler 
# å®ä¾‹ID
org.quartz.scheduler.instanceId = AUTO

#============================================================================
# Configure ThreadPool  
#============================================================================
org.quartz.threadPool.class = org.quartz.simpl.SimpleThreadPool
# çº¿ç¨‹ä¸ªæ•°
org.quartz.threadPool.threadCount = 3
org.quartz.threadPool.threadPriority = 5

#============================================================================
# Configure JobStore  
#============================================================================
org.quartz.jobStore.misfireThreshold = 60000
org.quartz.jobStore.class = org.quartz.simpl.RAMJobStore

#============================================================================
# Configure Plugins 
#============================================================================
org.quartz.plugin.triggHistory.class = org.quartz.plugins.history.LoggingJobHistoryPlugin
# org.quartz.plugins.xml.JobInitializationPluginæ˜¯Quartzè‡ªå¸¦çš„æ’ä»¶ï¼Œ
# é»˜è®¤æ—¶ï¼Œè¿™ä¸ªæ’ä»¶ä¼šåœ¨ classpath ä¸­æœç´¢åä¸º quartz_jobs.xml 
# çš„æ–‡ä»¶å¹¶ä»ä¸­åŠ è½½ Job å’Œ Trigger ä¿¡æ¯
# v1.8ä¹‹å‰ç”¨JobInitializationPlugin
#org.quartz.plugin.jobInitializer.class = org.quartz.plugins.xml.JobInitializationPlugin
org.quartz.plugin.jobInitializer.class = org.quartz.plugins.xml.XMLSchedulingDataProcessorPlugin
org.quartz.plugin.jobInitializer.fileNames = quartz_jobs.xml
org.quartz.plugin.jobInitializer.failOnFileNotFound = true
org.quartz.plugin.jobInitializer.scanInterval =10
org.quartz.plugin.jobInitializer.wrapInUserTransaction = false

# å…³é—­quartzæ–°ç‰ˆæœ¬æ£€æµ‹åŠŸèƒ½
org.quartz.scheduler.skipUpdateCheck = true
</code></pre></div></div>

<ul>
  <li>é…ç½®job.xml</li>
</ul>

<p>åŠ è½½è§¦å‘å™¨ç±»å‹ï¼Œå®šä¹‰è§¦å‘å™¨å±æ€§ç­‰ä¸€ç³»åˆ—jobDetailæ“ä½œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?xmlversion="1.0"encoding="UTF-8"?&gt; 
&lt;job-scheduling-dataxmlns="http://www.quartz-scheduler.org/xml/JobSchedulingData" 
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
   xsi:schemaLocation="http://www.quartz-scheduler.org/xml/JobSchedulingData http://www.quartz-scheduler.ogr/xml/job_scheduling_data_1_8.xsd" 
   version="1.8"&gt; 
   &lt;pre-processing-commands&gt; 
       &lt;!--åœ¨æ‰§è¡Œä½œä¸šå’Œè§¦çŠ¯å™¨ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤--&gt; 
       &lt;delete-jobs-in-group&gt;*&lt;/delete-jobs-in-group&gt; 
       &lt;!--åˆ é™¤æ ‡ç¤ºç»„ä¸­çš„æ‰€æœ‰ä½œä¸šï¼Œå¦‚æœæ˜¯â€œ*â€,åˆ™åˆ é™¤æ‰€æœ‰ç»„ä¸­çš„ä½œä¸šï¼ŒåŒæ—¶ä¹Ÿä¼šåˆ é™¤ä¸ä½œä¸šæœ‰å…³çš„è§¦çŠ¯å™¨ --&gt; 
       &lt;delete-triggers-in-group&gt;*&lt;/delete-triggers-in-group&gt; 
       &lt;!--åˆ é™¤æ ‡ç¤ºç»„ä¸­çš„æ‰€æœ‰è§¦çŠ¯å™¨ï¼Œå¦‚æœæ˜¯â€œ*â€,åˆ™åˆ é™¤æ‰€æœ‰ç»„ä¸­çš„è§¦å‘å™¨ --&gt; 
       &lt;delete-job&gt; 
           &lt;!--åˆ é™¤æŒ‡å®šçš„ä½œä¸šï¼ŒåŒæ—¶ä¹Ÿä¼šåˆ é™¤ä¸å®ƒå…³è”çš„è§¦çŠ¯å™¨ --&gt; 
           &lt;name&gt;&lt;/name&gt; 
           &lt;group&gt;&lt;/group&gt; 
       &lt;/delete-job&gt; 
       &lt;delete-trigger&gt; 
           &lt;!--åˆ é™¤æŒ‡å®šçš„è§¦çŠ¯å™¨ --&gt; 
           &lt;name&gt;&lt;/name&gt; 
           &lt;group&gt;&lt;/group&gt; 
       &lt;/delete-trigger&gt; 
   &lt;/pre-processing-commands&gt; 
 
   &lt;processing-directives&gt; 
       &lt;!--åœ¨è®¡åˆ’ä½œä¸šå’Œè§¦å‘å™¨æ˜¯åº”éµå¾ªçš„å‘½ä»¤å’ŒåŸåˆ™ --&gt; 
       &lt;overwrite-existing-data&gt;true or false&lt;/overwrite-existing-data&gt; 
       &lt;!--æ˜¯å¦å¤å†™å·²ç»å­˜åœ¨çš„ä»»åŠ¡è®¡åˆ’æ•°æ®ï¼Œå¦‚æœä¸ºfalseå¹¶ä¸”ingore-duplicateséfalseï¼Œé‚£ä¹ˆæ–‡ä»¶ä¸­åŒåçš„è§¦å‘å™¨æˆ–ä½œä¸šå°†ä¼šç»§ç»­å­˜åœ¨ï¼Œåˆ™ä¼šäº§ç”Ÿé”™è¯¯--&gt; 
       &lt;ignore-duplicates&gt;true or false&lt;/ignore-duplicates&gt; 
       &lt;!--å¦‚æœä¸ºtrueï¼Œè®¡åˆ’ä¸­çš„ä»»ä½•åŒåçš„ä½œä¸š/è§¦å‘å™¨å°†ä¼šè¢«å¿½ç•¥ï¼Œä¸ä¼šäº§ç”Ÿé”™è¯¯--&gt; 
   &lt;/processing-directives&gt; 
 
   &lt;schedule&gt; 
       &lt;job&gt; 
           &lt;name&gt;JobName&lt;/name&gt; 
           &lt;group&gt;JobGroup&lt;/group&gt; 
           &lt;description&gt;&lt;/description&gt; 
           &lt;job-class&gt;&lt;/job-class&gt; 
           &lt;job-listener-ref&gt;&lt;/job-listener-ref&gt; 
           &lt;!-- volatility,durability,recoverå¿…é¡»æŒ‰é¡ºåºè®¾å®š --&gt; 
           &lt;volatility&gt;&lt;/volatility&gt; 
           &lt;durability&gt;&lt;/durability&gt; 
           &lt;recover&gt;&lt;/recover&gt; 
           &lt;job-data-map&gt; 
               &lt;!-- entryå¯ä»¥è®¾å®šå¤šä¸ª--&gt; 
               &lt;entry&gt; 
                   &lt;key&gt;&lt;/key&gt; 
                   &lt;value&gt;&lt;/value&gt; 
               &lt;/entry&gt; 
           &lt;/job-data-map&gt; 
       &lt;/job&gt; 
       &lt;trigger&gt; 
           &lt;!-- Triggeråˆ†ä¸ºsimpleï¼Œcronï¼Œdate-intervalä¸‰ç§ç±»å‹ï¼Œä¸€ä¸ªtriggerä¸­åªèƒ½æŒ‡å®šä¸€ç§ç±»å‹--&gt; 
           &lt;simple&gt; 
               &lt;name&gt;&lt;/name&gt; 
               &lt;group&gt;&lt;/group&gt; 
               &lt;description&gt;&lt;/description&gt; 
               &lt;job-name&gt;&lt;/job-name&gt; 
               &lt;job-group&gt;&lt;/job-group&gt; 
               &lt;calendar-name&gt;&lt;/calendar-name&gt; 
               &lt;volatility&gt;&lt;/volatility&gt; 
               &lt;job-data-map&gt; 
                   &lt;entry&gt; 
                       &lt;key&gt;&lt;/key&gt; 
                       &lt;value&gt;&lt;/value&gt; 
                   &lt;/entry&gt; 
               &lt;/job-data-map&gt; 
               &lt;start-time&gt;&lt;/start-time&gt; 
               &lt;end-time&gt;&lt;/end-time&gt; 
               &lt;misfire-instruction&gt;&lt;/misfire-instruction&gt; 
               &lt;repeat-count&gt;&lt;/repeat-count&gt; 
               &lt;repeat-interval&gt;&lt;/repeat-interval&gt; 
           &lt;/simple&gt; 
           &lt;cron&gt; 
               &lt;name&gt;&lt;/name&gt; 
               &lt;group&gt;&lt;/group&gt; 
               &lt;description&gt;&lt;/description&gt; 
               &lt;job-name&gt;&lt;/job-name&gt; 
               &lt;job-group&gt;&lt;/job-group&gt; 
               &lt;calendar-name&gt;&lt;/calendar-name&gt; 
               &lt;volatility&gt;&lt;/volatility&gt; 
               &lt;job-data-map&gt; 
                   &lt;entry&gt; 
                       &lt;key&gt;&lt;/key&gt; 
                       &lt;value&gt;&lt;/value&gt; 
                   &lt;/entry&gt; 
               &lt;/job-data-map&gt; 
               &lt;start-time&gt;&lt;/start-time&gt; 
               &lt;end-time&gt;&lt;/end-time&gt; 
               &lt;misfire-instruction&gt;&lt;/misfire-instruction&gt; 
               &lt;cron-expression&gt;&lt;/cron-expression&gt; 
               &lt;time-zone&gt;&lt;/time-zone&gt; 
           &lt;/cron&gt; 
           &lt;date-interval&gt; 
               &lt;name&gt;&lt;/name&gt; 
               &lt;group&gt;&lt;/group&gt; 
               &lt;description&gt;&lt;/description&gt; &lt;job-group&gt;&lt;/job-group&gt; 
</code></pre></div></div>

<volatility></volatility>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>              &lt;job-data-map&gt; 
                   &lt;entry&gt; 
                       &lt;key&gt;&lt;/key&gt; 
                       &lt;value&gt;&lt;/value&gt; 
                   &lt;/entry&gt; 
               &lt;/job-data-map&gt; 
               &lt;start-time&gt;&lt;/start-time&gt; 
               &lt;end-time&gt;&lt;/end-time&gt; 
               &lt;misfire-instruction&gt;&lt;/misfire-instruction&gt; 
               &lt;repeat-interval&gt;&lt;/repeat-interval&gt; 
               &lt;repeat-interval-unit&gt;&lt;/repeat-interval-unit&gt; 
           &lt;/date-interval&gt; 
       &lt;/trigger&gt; 
   &lt;/schedule&gt; 
&lt;/job-scheduling-data&gt;
</code></pre></div></div>

<p>æœ¬ä¾‹ä½¿ç”¨çš„quartzç‰ˆæœ¬ä¸º1.8.6ï¼Œç°åœ¨å·²ç»æ›´æ–°åˆ°2.0ä»¥ä¸Šç‰ˆæœ¬</p>

<p>æœ¬ä¾‹quartz_job.xml</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?xmlversion="1.0"encoding="UTF-8"?&gt;  
&lt;job-scheduling-dataxmlns="http://www.quartz-scheduler.org/xml/JobSchedulingData" 
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
   xsi:schemaLocation="http://www.quartz-scheduler.org/xml/JobSchedulingData http://www.quartz-scheduler.org/xml/job_scheduling_data_1_8.xsd" 
   version="1.8"&gt;  
      
   &lt;pre-processing-commands&gt;  
       &lt;delete-jobs-in-group&gt;*&lt;/delete-jobs-in-group&gt; &lt;!-- clear all jobs in scheduler --&gt;  
       &lt;delete-triggers-in-group&gt;*&lt;/delete-triggers-in-group&gt;&lt;!-- clear all triggers in scheduler --&gt;  
   &lt;/pre-processing-commands&gt;  
      
   &lt;processing-directives&gt;  
       &lt;overwrite-existing-data&gt;true&lt;/overwrite-existing-data&gt;  
       &lt;ignore-duplicates&gt;false&lt;/ignore-duplicates&gt;   
   &lt;/processing-directives&gt;  
      
   &lt;schedule&gt;  
       &lt;job&gt;  
           &lt;name&gt;helloQuartzJob&lt;/name&gt;  
           &lt;group&gt;DEFAULT&lt;/group&gt;  
           &lt;description&gt;ç®€å•çš„quartzä½¿ç”¨&lt;/description&gt;  
           &lt;job-class&gt;HelloQuartzJob&lt;/job-class&gt;  
           &lt;volatility&gt;false&lt;/volatility&gt;  
           &lt;durability&gt;true&lt;/durability&gt;  
           &lt;recover&gt;false&lt;/recover&gt;  
       &lt;/job&gt;  
       &lt;trigger&gt;  
       &lt;cron&gt;
                &lt;name&gt;trigger&lt;/name&gt;     
              &lt;group&gt;DEFAULT&lt;/group&gt;     
              &lt;job-name&gt;helloQuartzJob&lt;/job-name&gt;     
              &lt;job-group&gt;DEFAULT&lt;/job-group&gt; 
             &lt;cron-expression&gt;30/5 * * * * ?&lt;/cron-expression&gt;
       &lt;/cron&gt;   
       &lt;/trigger&gt;
   &lt;/schedule&gt;      
&lt;/job-scheduling-data&gt;
</code></pre></div></div>

<ul>
  <li>
    <p>å»ºç«‹æµ‹è¯•ç”¨ä¾‹</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  public class HelloQuartzScheduling {
      @Test
      public void testQuartz() 
         throws SchedulerException, ParseException {
         //  åŠ è½½quartzå®¹å™¨
         SchedulerFactory schedulerFactory = new StdSchedulerFactory();
         Scheduler scheduler = schedulerFactory.getScheduler();
		   
         scheduler.start();              
      }   
  }
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="å’Œspringç›¸ç»“åˆ">å’Œspringç›¸ç»“åˆ</h2>

<p>åœ¨spring-contenté‡ŒåŠ å…¥bean</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;!--ä½¿ç”¨MethodInvokingJobDetailFactoryBeanï¼Œä»»åŠ¡ç±»å¯ä»¥ä¸å®ç°Jobæ¥å£ï¼Œé€šè¿‡targetMethodæŒ‡å®šè°ƒç”¨æ–¹æ³•--&gt;    
    &lt;!-- å®šä¹‰ç›®æ ‡beanå’Œbeanä¸­çš„æ–¹æ³• --&gt;  
    &lt;bean id="SpringQtzJob" class="com.chenfan.server.HelloQuartzJob"/&gt;  
    &lt;bean id="SpringQtzJobMethod" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"&gt;  
    &lt;property name="targetObject"&gt;  
        &lt;ref bean="SpringQtzJob"/&gt;  
    &lt;/property&gt;  
    &lt;property name="targetMethod"&gt;  &lt;!-- è¦æ‰§è¡Œçš„æ–¹æ³•åç§° --&gt;  
        &lt;value&gt;execute&lt;/value&gt;  
    &lt;/property&gt;  
&lt;/bean&gt;  
  
&lt;!-- ======================== è°ƒåº¦è§¦å‘å™¨ ======================== --&gt;  
&lt;bean id="CronTriggerBean" class="org.springframework.scheduling.quartz.CronTriggerBean"&gt;  
    &lt;property name="jobDetail" ref="SpringQtzJobMethod"&gt;&lt;/property&gt;  
    &lt;property name="cronExpression" value="0/5 * * * * ?"&gt;&lt;/property&gt;  
&lt;/bean&gt;  
  
&lt;!-- ======================== è°ƒåº¦å·¥å‚ ======================== --&gt;  
&lt;bean id="SpringJobSchedulerFactoryBean" class="org.springframework.scheduling.quartz.SchedulerFactoryBean"&gt;  
    &lt;property name="triggers"&gt;  
        &lt;list&gt;  
            &lt;ref bean="CronTriggerBean"/&gt;  
        &lt;/list&gt;  
    &lt;/property&gt;  
&lt;/bean&gt;    
</code></pre></div></div>

<p>åœ¨web.xmlé‡ŒåŠ è½½spring-content.xml</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;  
&lt;web-app xmlns="http://java.sun.com/xml/ns/javaee"  
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
         xsi:schemaLocation="http://java.sun.com/xml/ns/javaee  
          http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"  
         version="2.5"&gt;  
    &lt;welcome-file-list&gt;  
        &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;  
    &lt;/welcome-file-list&gt;  
  
    &lt;context-param&gt;  
        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;  
        &lt;param-value&gt;/WEB-INF/spring-config.xml&lt;/param-value&gt;  
    &lt;/context-param&gt;  
  
    &lt;listener&gt;  
        &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;  
    &lt;/listener&gt;  
&lt;/web-app&gt;
</code></pre></div></div>
:ET